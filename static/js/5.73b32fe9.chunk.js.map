{"version":3,"sources":["hooks/useSaveBlock.js","components/edit/LocaleSelect.js","components/apps/PageEditor.module.css","components/edit/SharingEditor.module.css","components/edit/HtmlInput.module.css","components/edit/TranslationEditor.module.css","components/edit/InputWithLocal.module.css","components/Repeater.module.css","components/edit/FancyInput.module.css","components/edit/PermissionsEditor.module.css","components/edit/PropertiesEditor.module.css","components/edit/CoverphotoPicker.module.css","components/edit/StorageFileInput.module.css","components/edit/IconPicker.module.css","components/edit/InlineEditorBlock.module.css","components/edit/ContentEditor.module.css","components/edit/HtmlInput.js","components/edit/SharingEditor.js","components/edit/InputWithLocal.js","components/Repeater.js","components/edit/TranslationEditor.js","components/edit/FancyInput.js","components/edit/EmailInput.js","components/edit/PermissionsEditor.js","components/edit/UrlInput.js","components/edit/StorageFileInput.js","components/edit/ImagePicker.js","images/coverphotos/thumbs/20200912_Plakatschlange_Koeln_Matteo Sant_Unione_011.png","images/coverphotos/thumbs/Aktion.png","components/edit/CoverphotoPicker.js","images/coverphotos/thumbs/tYADz4UyUAAcV5WlmWLlkXD9LG8W02U9LbQd8rxzQ2bt99lxwK.png","images/coverphotos/thumbs/Welcome-to-Volt.png","images/coverphotos/thumbs/portugal.jpg","components/edit/IconPicker.js","components/edit/SlugInput.js","hooks/useCheckSlug.js","components/edit/PropertiesEditor.js","components/edit/CheckboxInput.js","components/edit/InlineEditorBlockText.js","components/edit/InlineEditorBlockButton.js","components/edit/InlineEditorBlockRedirect.js","components/edit/InlineEditorBlockDivider.js","components/edit/InlineEditorBlockCheckbox.js","components/edit/InlineEditorBlockPerson.js","components/edit/InlineEditorBlockPage.js","components/edit/InlineEditorBlockImage.js","components/edit/InlineEditorBlock.js","components/edit/ContentEditor.js","components/apps/PageEditor.js","pages/Editor.js"],"names":["removeProperty","obj","prop","i","JSON","parse","stringify","hasOwnProperty","useSaveBlock","getString","useLocalization","apollo_client","useApolloClient","useSnackbar","enqueueSnackbar","closeSnackbar","handleSaveBlock","useCallback","initialBlock","Promise","final_resolve","snackbarKey","newBlock","Array","isArray","content","map","contentConfig","blockId","loadingDataPromise","resolve","mutate","mutation","saveBlock_Mutation","variables","block","then","a","data","error","variant","preventDuplicate","autoHideDuration","saveBlock","catch","console","message","race","setTimeout","response","persist","locales","_","en","de","es","pt","fr","it","nl","da","sv","nb","fi","se","mt","pl","ru","bg","tr","ar","el","ro","sl","localesArray","Object","entries","code","nativeName","defaultOptions","keys","LocaleSelect","defaultValue","onChange","options","style","undefined","length","useState","changedLocale","setChangedLocale","handleLocaleChange","newLocale","trigger","triggerProps","isOpen","className","margin","flexShrink","width","textAlign","path","mdiTranslate","toUpperCase","marginLeft","lineHeight","verticalAlign","paperProps","sx","maxHeight","close","padding","filter","includes","onClick","selected","module","exports","getInLineRangeLength","element","whichLine","normalize","window","getSelection","selection","range","rangeCount","getRangeAt","clonedRange","cloneRange","selectNodeContents","setEnd","endContainer","endOffset","cloneContents","rangeLength","childNodes","nodeType","detach","getCaretPosition","cs","getComputedStyle","paddingY","parseFloat","paddingTop","paddingBottom","borderY","borderTopWidth","borderBottomWidth","elementHeight","offsetHeight","offset","getOffset","caretOffset","getCaretOffset","top","left","inFirstLine","height","inLastLine","caretPositionFromStart","node","textContent","nodeName","getRangeLengthWithLinebreaks","textLength","innerText","caretPositionFromEnd","positionFromLineStart","positionFromStart","positionFromEnd","HtmlInput","type","children","onBlur","linebreaks","onError","placeholder","onInputRef","onGoToPrevInput","onGoToNextInput","onSplitText","onMergeToPrevInput","onMergeFromNextInput","inputRef","useRef","textRef","textRefValue","current","__html","fakeDefaultValue","setFakeDefaultValue","updateText","newHtmlValue","html","temporalDivElement","document","createElement","innerHTML","stripHtml","useEffect","handleTextChange","event","value","target","replace","trim","handleTextBlur","keyDownHandler","key","shiftKey","execCommand","preventDefault","caret","start","slice","end","texts","text","handlePaste","originalEvent","clipboardData","getData","ref","onKeyDown","onInput","onPaste","classes","rebuild_textarea","show_placeholder","contentEditable","dangerouslySetInnerHTML","copyTextToClipboard","navigator","clipboard","writeText","info","err","textArea","position","body","appendChild","focus","select","msg","removeChild","fallbackCopyTextToClipboard","SharingEditor","defaultBlock","open","onClose","slug","setSlug","initialSlug","properties","saveSlug","newSlug","newProperties","Modal","hideBackdrop","backdrop","dialog","inputWrapper","paddingRight","linebreak","input","opacity","actions","href","rel","click","marginInlineStart","Localized","id","alert","marginInlineEnd","InputWithLocal","reorderHandle","actionButton","locale","dataset","changedText","setChangedText","handleBlur","changes","event_or_text","input_with_local","flexGrow","Row","subDefaultValue","index","render","handleRowChange","isReorderable","handleAddRow","handleRemoveRow","showReorderControls","reorderLabel","showActionButton","hasOnlyOneRow","addRowByIndex","draggableId","tmp_id","isDragDisabled","disableInteractiveElementBlocking","shouldRespectForcePress","provided","innerRef","draggableProps","row","form","inlineRowButton","dragHandleButton","dragHandleProps","item","onRemoveRow","addRowBefore","newValue","addRowAfter","getIndex","eventOrIndex","parseInt","isNaN","Repeater","addDefaultValue","addButtonText","hideAddButton","prependNewItems","rows","setRows","internalAddDefaultValue","tmp_defaultValue","uuidv4","new_rows","splice","rows_from_onChange","addButton","addRowButton","marginBottom","onDragEnd","result","destination","source","list","startIndex","endIndex","from","removed","reorder","droppableId","isDropDisabled","droppableProps","SimpleTranslationRepeater","onSaveProperty","isFirst","translations","onRepeaterChange","newTranslations","translation","onBlockLocaleChange","block2display","text_style","display","alignItems","gap","ViewerAuto","minHeight","clickable","repeater_props","other_repeater_props","InputWithLocal_props","TranslationEditor","blocks","setBlocks","loadBlocks","useLoadBlocks","ids2load","_id","loadedBlocks","ids","contentBlocks","find","Boolean","loadContentBlocks","newBlocks","onSaveChildProperty","gottenBlock","blockIndex","findIndex","zIndex","flatMap","attr","FancyInput","setError","split","email_regex","emails_regex","EmailInput","multiple","props","isSubmittable","emails","match","LocalizedRole","role","RolesMenu","changeRole","removePermission","React","anchorEl","setAnchorEl","handleClose","currentTarget","Menu","MenuListProps","maxWidth","background","color","MenuItem","disabled","ListItemIcon","ListItemText","Edit","Divider","Delete","Close","sortPermissions","permissions","owner","p","sort","b","email","localeCompare","special","other","PermissionsEditor","defaultPermissions","user_data","useUser","user_email","user","inputRepaintKey","setInputRepaintKey","setPermissions","newEmails","setNewEmails","newRole","setNewRole","setNewPermission","newPermissions","array","obj_new","permission","unshift","blockPermissions","addPermissions","push","newEmail","addNewPermissionFromInput","oldInputRepaintKey","doesNotHaveVoltEuropa","doesNotHavePublic","menuButton","KeyboardArrowDown","marginTop","permissionRow","ownerInfo","url_regex","is_email_not_url_regex","UrlInput","setText","schema_parts","schema","shift","after_schema","join","resize","file","reject","MAX_HEIGHT","MAX_WIDTH","image","Image","onload","canvas","ctx","getContext","clearRect","drawImage","fileType","toBlob","newBlob","resizedFile","File","name","lastModified","Date","onerror","data_url","URL","createObjectURL","src","StorageFileInput","fileInputRef","uploadProgressText","setUploadProgressText","loading","setLoading","singleUpload","files","startsWith","size","thisFile","new_file","formData","FormData","operations","query","append","xhr","XMLHttpRequest","withCredentials","graphql_uri","status","statusText","e","errors","upload","onprogress","lengthComputable","percentComplete","loaded","total","send","String","root","loadingText","accept","isAbsoluteUrlRegexp","RegExp","withLocalization","types","urlSuggestions","imageValue","setType","url","setUrl","emoji","setEmoji","fileId","setFileId","existingImages","setExistingImages","handleEmojiChange","emojiObject","newEmoji","handleTypeChange","newType","handleUrlChange","newUrl","handleFileChange","newFileId","archived","test","Popover","closePopover","popoverProps","Paper","overflow","elevation","marginRight","MultiButton","ariaLabel","items","icon","alt","native","onEmojiClick","searchPlaceholder","disableAutoFocus","pickerStyle","boxShadow","border","borderRadius","domains","storage","imageFormat","encodeURIComponent","title","cursor","plakatschlange_thumb","aktion_thumb","coverphotoValue","iconValue","coverphotoIsSet","setCoverphotoIsSet","newCoverphotoIsSet","iconIsSet","imageUrl","iconIsNotSet","coverphotoIsNotSet","coverphoto","backgroundImage","button_wrapper","changeCoverphotoButton","setIconIsSet","newIconIsSet","lengh","iconWrapper","Twemoji","emojiWrapper","changeIconButton","SlugInput","onSubmit","allowExisting","mountedRef","checkSlug","handleCheckSlug","checkSlug_Query","useCheckSlug","newText","toLowerCase","isOkay","defaultProperties","setProperties","updateProperty","propertyKey","newPropertyValue","silent","propertyTypes","imprint","privacy_policy","tags","checked","pronouns","publishProperties","propertiesFrameContent","properties_row","main_headline","paddingLeft","propertiesFrame","CheckboxInput","setChecked","iconProps","newChecked","CheckBox","CheckBoxOutlineBlank","InlineEditorBlockText","saveProperty","onSaveBlock","onAddRowAfter","publishTextChange","text_style_class","getBlockColor","colorStyles","toggleChecked","newCheckedValue","text_decorations","prefixes","checkbox_component","backgroundColor","InlineEditorBlockButton","og_url","publishChanges","colorRGB","contrastingColor","InlineEditorBlockRedirect","og_slug","slugRef","urlRef","paddingInlineStart","BlockIcon","fontWeight","InlineEditorBlockDivider","styles","InlineEditorBlockCheckbox","saveChecked","InlineEditorBlockPerson","dragable","pathSuffix","InlineEditorBlockPage","InlineEditorBlockImage","og_coverphoto","setCoverphoto","saveCoverphoto","newCoverphoto","InlineEditorBlockInbetweenComponent","component","InlineEditorBlock","fluentByObject","onRemoveSelf","setBlock","active","handleBlockChange","saveType","propertyName","callback","onArchiveToggle","newArchivedValue","BlockMenu","onArchivedToggle","block_input","form_active","form_deactivated","addTmpIds","getFirstLineStartNode","getLastLineStartNode","reverse","lastLineNode","childNode","thisChildNodes","moveCursorToOffsetInLine","contentEditableElement","lastLineStartNode","lastLineStartNodeLength","createRange","setStart","collapse","sel","removeAllRanges","addRange","ContentEditor","parentId","contentConfigs_Ref","contentConfigs","inputRefs_Ref","inputRefs","updateCounter","setUpdateCounter","archiveBlock","useArchiveBlock","autoFocus","setAutoFocus","firstLineStartNode","newContentConfigs","old","loadMissingBlocks","saveInputRef","newInputRefs","goToPrevInput","prevInputRef","thisIndex","goToNextInput","nextInputRef","focusLastLine","lastInputRef","newContentConfig","oldContentConfig","loadedBlock","createBlockByType","parent","clonedContentConfigs","prev_index","prev_contentConfig","prev_tmp_id","this_block","prev_block","prev_text","this_text","prev_block_properties2update","savedPrevBlock","new_tmp_id","archive","next_index","this_old_contentConfig","next_block","next_text","this_block_properties2update","savedBlock","splitText","firstBlock","secondBlock","savedFirstBlock","savedSecondBlock","nextContentConfig","handleRemoveSelf","filteredContentConfigs","AddMenu","createBlock","pointerEvents","Add","Tooltip","flattenObject","parentKey","res","propName","PageEditor","isSharingEditorOpen","setIsSharingEditorOpen","openSharingEditor","closeSharingEditor","isTranslationEditorOpen","setIsTranslationEditorOpen","openTranslationEditor","closeTranslationEditor","isPermissionsEditorOpen","setIsPermissionsEditorOpen","openPermissionsEditor","closePermissionsEditor","saveProperties","oldPropertiesFlattend","newPropertiesFlattend","divergingProperties","reduce","acc","unflattenObject","saveContent","newContent","savePermissions","manuallySaveEverything","PermissionsIcon","mdiLockAlert","computed","inherited_block_permissions","inherited_block_permissions_obj","curr","mdiEarth","mdiAccountLockOpen","rightHeaderActions","whiteSpace","typeOptions","helmet_title","editor","Helmet","property","Header","rightActions","ErrorPage","lazy","Editor","loadingTheBlock","loadPage","useLoadPage","useParams","slugOrId","slugOrId_to_use","setAndTrackError","umami","trackEvent","for_slugOrId","newLoadedBlock","loadedContentBlocks","viewer","app","spine_aligned","dir","contentWrapper","forceId","errorName"],"mappings":"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","file":"static/js/5.73b32fe9.chunk.js","sourcesContent":["import { useCallback } from 'react'\n\nimport { useLocalization } from '../fluent/Localized.js'\n\nimport { useApolloClient } from '@apollo/client'\nimport { saveBlock_Mutation } from '../graphql/mutations.js'\n\nimport { useSnackbar } from 'notistack'\n\nfunction removeProperty(obj, prop) {\n  // remove property from objects, arrays and sub-objects\n\n  obj = JSON.parse(JSON.stringify(obj)) // clone object to make everything mutable\n\n  if (obj.hasOwnProperty(prop)) {\n    delete obj[prop]\n  }\n  for (const i in obj) {\n    if (obj.hasOwnProperty(i)) {\n      if (typeof obj[i] == 'object' && obj[i] !== null) {\n        removeProperty(obj[i], prop)\n      }\n    }\n  }\n\n  return obj\n}\n\nfunction useSaveBlock() {\n  const { getString } = useLocalization()\n\n  const apollo_client = useApolloClient()\n  const { enqueueSnackbar, closeSnackbar } = useSnackbar()\n\n  const handleSaveBlock = useCallback((initialBlock) => {\n    return new Promise(final_resolve => {\n      let snackbarKey = null\n\n      let newBlock = {...initialBlock}\n      newBlock = removeProperty(newBlock, '__typename')\n      if (newBlock.hasOwnProperty('content') && Array.isArray(newBlock.content)) {\n        newBlock.content = newBlock.content.map(contentConfig => ({\n          blockId: contentConfig.blockId,\n        }))\n      }\n\n      const loadingDataPromise = new Promise(resolve => {\n        apollo_client.mutate({\n          mutation: saveBlock_Mutation,\n          variables: {\n            block: newBlock\n          },\n        })\n          .then(async ({ data }) => {\n            resolve('got-data')\n\n            if (snackbarKey !== null) {\n              closeSnackbar(snackbarKey)\n            }\n\n            if (typeof data.error === 'string') {\n              if (data.error === 'no_edit_permission') {\n                enqueueSnackbar(getString('path_editor_edit_permission_error'), {\n                  variant: 'error',\n                  preventDuplicate: true,\n                  autoHideDuration: 2000,\n                })\n              } else {\n                enqueueSnackbar('' + data.error, {\n                  variant: 'error',\n                  preventDuplicate: true,\n                  autoHideDuration: 2000,\n                })\n              }\n            } else {\n              const block = data.saveBlock\n\n              final_resolve(block)\n\n              enqueueSnackbar(getString('path_editor_status_saved'), {\n                variant: 'success',\n                preventDuplicate: false,\n                autoHideDuration: 2000,\n              })\n            }\n          })\n          .catch(async error => {\n            console.error(error)\n            resolve('got-error')\n\n            if (snackbarKey !== null) {\n              closeSnackbar(snackbarKey)\n            }\n\n            enqueueSnackbar(getString('path_editor_status_error_while_saving', {\n              error: error.message,\n            }), {\n              variant: 'error',\n              preventDuplicate: true,\n              autoHideDuration: 2000,\n            })\n          })\n      })\n\n      // Show a loading-info-snackbar if loading the data takes too long.\n      Promise.race([\n        new Promise(resolve => {\n          setTimeout(() => {\n            resolve('show-loading')\n          }, 300)\n        }),\n        loadingDataPromise,\n      ])\n        .then(response => {\n          if (response === 'show-loading') {\n            snackbarKey = enqueueSnackbar(getString('path_editor_status_started_saving'), {\n              persist: true,\n              preventDuplicate: true,\n            })\n          }\n        })\n        .catch(console.error)\n\n    })\n  }, [\n    enqueueSnackbar,\n    closeSnackbar,\n    apollo_client,\n    getString,\n  ])\n\n  return handleSaveBlock\n}\n\nexport default useSaveBlock\n","import { useState, useCallback } from 'react'\n\nimport {\n  MenuItem,\n} from '@mui/material'\n\nimport PopoverMenu from '../PopoverMenu.js'\n\nimport MdiIcon from '@mdi/react'\nimport {\n  mdiTranslate,\n} from '@mdi/js'\n\nconst locales = {\n  _: '??',\n  en: 'English',\n  de: 'Deutsch',\n  es: 'Espaol',\n  pt: 'Portugus',\n  fr: 'Franais',\n  it: 'Italiano',\n  nl: 'Nederlands', // Dutch\n  da: 'Dansk', // Danish\n  sv: 'Svenska', // Swedish\n  nb: 'Norsk bokml', // Norwegian\n  fi: 'Suomi', // Finish\n  se: 'Davvismegiella (Northern Sami)', // Northern Sami\n  mt: 'Malti', // Maltese\n  pl: 'Jzyk polski', // Polish\n  ru: ' ', // Russian\n  bg: ' ', // Bulgarian\n  tr: 'Trke',\n  ar: '', // Arabic\n  el: '', // Greek\n  ro: 'limba romn', // Romanian\n  sl: 'slovenina', // Slovenian\n  // uk: ' ', // Ukrainian\n  // cy: 'Cymraeg', // Welsh\n}\n\nconst localesArray = Object.entries(locales)\n.map(([code, nativeName]) => ({code, nativeName}))\n\nconst defaultOptions = Object.keys(locales)\n\nfunction LocaleSelect({\n  defaultValue,\n  onChange,\n  options = defaultOptions,\n  style,\n}) {\n  if (\n    defaultValue === null\n    || defaultValue === undefined\n    || defaultValue === ''\n    || locales.hasOwnProperty(defaultValue) === false\n  ) {\n    if (options.length > 0) {\n      defaultValue = options[0]\n    } else {\n      defaultValue = '_'\n    }\n  }\n\n  const [changedLocale, setChangedLocale] = useState(defaultValue)\n\n  const handleLocaleChange = useCallback(newLocale => {\n    // TODO: get best match with fluent\n\n    setChangedLocale(newLocale)\n    \n    if (newLocale === '_') {\n      newLocale = null\n    }\n\n    if (onChange) {\n      onChange(newLocale)\n    }\n  }, [ setChangedLocale, onChange ])\n\n  return (\n    <PopoverMenu\n      trigger={(triggerProps, { isOpen }) => (\n        <button\n          {...triggerProps}\n          className=\"default hasIcon\"\n          style={{\n            margin: '0',\n            flexShrink: '0',\n            ...style,\n          }}\n        >\n          <span style={{ width: '100%', textAlign: 'start' }}>\n          {\n            changedLocale === '_'\n            ? <MdiIcon\n              path={mdiTranslate}\n              className=\"icon\"\n            />\n            : changedLocale.toUpperCase()\n          }\n          </span>\n          <span style={{\n            marginLeft: 'var(--basis)',\n            lineHeight: '1',\n            verticalAlign: 'text-top',\n          }}>\n            { isOpen ? '' : '' }\n          </span>\n        </button>\n      )}\n      paperProps={{\n        sx: {\n          maxHeight: '300px',\n        }\n      }}\n    >\n      {({ close }) => (\n        <div style={{\n          padding: 'var(--basis_x2) 0',\n        }}>\n          {\n            localesArray\n            .filter(({ code }) => options.includes(code))\n            .map(({ code, nativeName }) => (\n              <MenuItem\n                key={code}\n                onClick={() => {\n                  handleLocaleChange(code)\n                  close()\n                }}\n                className=\"roundMenuItem\"\n                selected={code === changedLocale}\n              >\n                {code === '_' ? nativeName : `${code.toUpperCase()}  ${nativeName}`}\n              </MenuItem>\n            ))\n          }\n        </div>\n      )}\n    </PopoverMenu>    \n  )\n}\n\nexport default LocaleSelect\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"app\":\"PageEditor_app__26Zo3\",\"spine_aligned\":\"PageEditor_spine_aligned__2i6Wu\",\"contentWrapper\":\"PageEditor_contentWrapper__WlUIr\",\"editor\":\"PageEditor_editor__U1pPN\",\"type_redirect\":\"PageEditor_type_redirect__2KPht\",\"loadingContent\":\"PageEditor_loadingContent__1YK7g\",\"editor_form_row\":\"PageEditor_editor_form_row__j4vjp\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dialog\":\"SharingEditor_dialog__22jfY\",\"backdrop\":\"SharingEditor_backdrop__1Gra9\",\"inputWrapper\":\"SharingEditor_inputWrapper__1UyBD\",\"input\":\"SharingEditor_input__brkXK\",\"actions\":\"SharingEditor_actions__2zz6x\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"rebuild_textarea\":\"HtmlInput_rebuild_textarea__ZfRzZ\",\"show_placeholder\":\"HtmlInput_show_placeholder__hM8g2\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dialog\":\"TranslationEditor_dialog__YL0sv\",\"backdrop\":\"TranslationEditor_backdrop__hfIzh\",\"inputWrapper\":\"TranslationEditor_inputWrapper__3aVMH\",\"input\":\"TranslationEditor_input__3U2bK\",\"actions\":\"TranslationEditor_actions__3dTaz\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"input_with_local\":\"InputWithLocal_input_with_local__3qqYa\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"row\":\"Repeater_row__1ODoF\",\"middleActions\":\"Repeater_middleActions__3nRoT\",\"trigger\":\"Repeater_trigger__1VtG5\",\"content\":\"Repeater_content__110R9\",\"form\":\"Repeater_form__2N6kw\",\"item\":\"Repeater_item__2OI78\",\"inlineRowButton\":\"Repeater_inlineRowButton__uqk8Y\",\"dragHandleButton\":\"Repeater_dragHandleButton__2eLww\",\"addRowButton\":\"Repeater_addRowButton__3huSP\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"error\":\"FancyInput_error__2DFWE\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dialog\":\"PermissionsEditor_dialog__2rpyk\",\"backdrop\":\"PermissionsEditor_backdrop__1dRPN\",\"inputWrapper\":\"PermissionsEditor_inputWrapper__4DGsr\",\"input\":\"PermissionsEditor_input__1HyOC\",\"actions\":\"PermissionsEditor_actions__k4oBn\",\"permissionRow\":\"PermissionsEditor_permissionRow__2HaWO\",\"menuButton\":\"PermissionsEditor_menuButton__2jIMI\",\"ownerInfo\":\"PermissionsEditor_ownerInfo__EEKXP\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main_headline\":\"PropertiesEditor_main_headline__3wy7R\",\"propertiesFrame\":\"PropertiesEditor_propertiesFrame__1uBEz\",\"properties_row\":\"PropertiesEditor_properties_row__2tX7M\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"CoverphotoPicker_root__3T8t9\",\"coverphoto\":\"CoverphotoPicker_coverphoto__1mWB4\",\"coverphotoIsNotSet\":\"CoverphotoPicker_coverphotoIsNotSet__1O3-S\",\"button_wrapper\":\"CoverphotoPicker_button_wrapper__2oEjh\",\"coverphotoIsSet\":\"CoverphotoPicker_coverphotoIsSet__2o24A\",\"iconIsSet\":\"CoverphotoPicker_iconIsSet__D_4uA\",\"changeCoverphotoButton\":\"CoverphotoPicker_changeCoverphotoButton__2GnZD\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"StorageFileInput_root__1MhoY\",\"inputWrapper\":\"StorageFileInput_inputWrapper__fUwIT\",\"loadingText\":\"StorageFileInput_loadingText__2q-OV\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"IconPicker_root__2okyv\",\"iconIsSet\":\"IconPicker_iconIsSet__SnQwA\",\"coverphotoIsSet\":\"IconPicker_coverphotoIsSet__3m9Dw\",\"icon\":\"IconPicker_icon__JWgfX\",\"image_type_url\":\"IconPicker_image_type_url__3IKNM\",\"image_type_file\":\"IconPicker_image_type_file__nrsbm\",\"iconWrapper\":\"IconPicker_iconWrapper__1zo6g\",\"sizing_pixel\":\"IconPicker_sizing_pixel__3TeE0\",\"iconIsNotSet\":\"IconPicker_iconIsNotSet__1T0Zd\",\"emojiWrapper\":\"IconPicker_emojiWrapper__2b_Qv\",\"changeIconButton\":\"IconPicker_changeIconButton__TxsdG\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"block\":\"InlineEditorBlock_block__14-zd\",\"block_input\":\"InlineEditorBlock_block_input__2I1iu\",\"form_deactivated\":\"InlineEditorBlock_form_deactivated__2oktp\",\"form_active\":\"InlineEditorBlock_form_active__hi5HC\",\"reorderHandle\":\"InlineEditorBlock_reorderHandle__2_s23\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"row\":\"ContentEditor_row__JonRI\",\"form\":\"ContentEditor_form__wtoB9\",\"item\":\"ContentEditor_item__3U0XE\",\"inlineRowButton\":\"ContentEditor_inlineRowButton__2pw6r\",\"dragHandleButton\":\"ContentEditor_dragHandleButton__1Y_RP\"};","import React, { useCallback, useRef, useState, useEffect } from 'react'\n\n// import hljs from 'highlight.js/lib/core'\n// import javascript from 'highlight.js/lib/languages/javascript'\n// // import 'highlight.js/styles/github.css'\n// import '../../highlightjs-volt-theme.css'\n\nimport {\n  offset as getCaretOffset,\n  getOffset,\n} from 'caret-pos'\n\nimport classes from './HtmlInput.module.css'\n\n// hljs.registerLanguage('javascript', javascript)\n\nfunction stripHtml(html){\n  // source: https://ourcodeworld.com/articles/read/376/how-to-strip-html-from-a-string-extract-only-text-content-in-javascript\n  // Create a new div element\n  var temporalDivElement = document.createElement(\"div\");\n  // Set the HTML content with the providen\n  temporalDivElement.innerHTML = html;\n  // Retrieve the text property of the element (cross-browser support)\n  return temporalDivElement.textContent || temporalDivElement.innerText || \"\";\n}\n\nfunction getRangeLengthWithLinebreaks(element){\n  element.normalize()\n\n  if (!window.getSelection) {\n    return 0;\n  }\n\n  const selection = window.getSelection()\n  const range = selection.rangeCount > 0 ? selection.getRangeAt(0) : null;\n\n  if (!range) {\n    return 0;\n  }\n\n  const clonedRange = range.cloneRange()\n  clonedRange.selectNodeContents(element)\n  clonedRange.setEnd(range.endContainer, range.endOffset)\n  const content = clonedRange.cloneContents()\n\n  let rangeLength = 0\n  for (const node of content.childNodes) {\n    if (node.nodeType === 3) { // node type = 3 is a text node\n      rangeLength += node.textContent.length\n    } else if (node.nodeType === 1 && node.nodeName === 'BR') { // node type = 1 is an element node\n      rangeLength += 1\n    }\n  }\n\n  clonedRange.detach()\n\n  return rangeLength\n}\n\nfunction getInLineRangeLength(element, whichLine){\n  element.normalize()\n\n  if (!window.getSelection) {\n    return 0;\n  }\n\n  const selection = window.getSelection()\n  const range = selection.rangeCount > 0 ? selection.getRangeAt(0) : null;\n\n  if (!range) {\n    return 0;\n  }\n\n  const clonedRange = range.cloneRange()\n  clonedRange.selectNodeContents(element)\n  clonedRange.setEnd(range.endContainer, range.endOffset)\n  const content = clonedRange.cloneContents()\n\n  let rangeLength = 0\n  if (content.childNodes.length > 0) {\n    if (whichLine === 'first') {\n      if (content.childNodes[0].nodeType === 3) {\n        rangeLength = content.childNodes[0].length\n      } else {\n        rangeLength = 0\n      }\n    } else if (whichLine === 'last') {\n      if (content.childNodes[content.childNodes.length-1].nodeType === 3) {\n        rangeLength = content.childNodes[content.childNodes.length-1].length\n      } else {\n        if (content.childNodes.length > 1) {\n          if (content.childNodes[content.childNodes.length-2].nodeType === 3) {\n            rangeLength = content.childNodes[content.childNodes.length-2].length\n          } else {\n            rangeLength = 0\n          }\n        } else {\n          rangeLength = 0\n        }\n      }\n    }\n  }\n\n  clonedRange.detach()\n\n  return rangeLength\n}\n\nfunction getCaretPosition(element){\n  // get element height without padding and border\n  const cs = getComputedStyle(element)\n  const paddingY = parseFloat(cs.paddingTop) + parseFloat(cs.paddingBottom)\n  const borderY = parseFloat(cs.borderTopWidth) + parseFloat(cs.borderBottomWidth)\n  const elementHeight = element.offsetHeight - paddingY - borderY\n\n  // get caret position\n  const offset = getOffset(element)\n  const caretOffset = getCaretOffset(element)\n  caretOffset.top = caretOffset.top - offset.top\n  caretOffset.left = caretOffset.left - offset.left\n\n  // check if caret is in the first line\n  let inFirstLine = caretOffset.top < caretOffset.height\n\n  // check if caret is in the last line\n  let inLastLine = elementHeight - caretOffset.top < caretOffset.height\n\n  // define caret position from start of text\n  const caretPositionFromStart = getRangeLengthWithLinebreaks(element)\n\n  // calc caret position from end of text\n  let textLength = element.innerText.length ||0\n  if (textLength < 0) {\n    textLength = 0\n  }\n  const caretPositionFromEnd = textLength - caretPositionFromStart\n\n  return {\n    inFirstLine,\n    inLastLine,\n    left: caretOffset.left,\n    top: caretOffset.top,\n    height: caretOffset.height,\n    positionFromLineStart: getInLineRangeLength(element, (inFirstLine ? 'first' : 'last')),\n    positionFromStart: caretPositionFromStart,\n    positionFromEnd: caretPositionFromEnd,\n  }\n}\n\nfunction HtmlInput({\n  type = 'text',\n  defaultValue = '',\n  children,\n  className,\n  onChange,\n  onBlur,\n  onError,\n  linebreaks,\n  style,\n  placeholder = '',\n\n  onInputRef,\n  onGoToPrevInput,\n  onGoToNextInput,\n  onSplitText,\n  onMergeToPrevInput,\n  onMergeFromNextInput,\n\n  ...props\n}) {\n  const inputRef = useRef(null)\n\n  const textRef = useRef('')\n  const textRefValue = textRef.current\n  \n  const [fakeDefaultValue, setFakeDefaultValue] = useState({ __html: '' })\n\n  const updateText = useCallback(defaultValue => {\n\n    let newHtmlValue = stripHtml(defaultValue)\n\n    // if (type === 'code') {\n    //   // const html = hljs.highlightAuto(newHtmlValue, { ignoreIllegals: false })\n    //   const html = hljs.highlight(newHtmlValue, { language: 'javascript', ignoreIllegals: false })\n    //   newHtmlValue = html.value\n    // // } else {\n    // //   newHtmlValue = newHtmlValue\n    // //     // .replace(/\\t/g, '&emsp;')\n    // //     .replace(/</g, '&lt;')\n    // //     .replace(/>/g, '&gt;')\n    // //     // .replace(/\\n/g, '<br />')\n    // }\n\n    textRef.current = defaultValue\n\n    if (fakeDefaultValue.__html !== newHtmlValue) {\n      return setFakeDefaultValue({__html: newHtmlValue})\n    }\n  }, [\n    // type,\n    fakeDefaultValue,\n    setFakeDefaultValue,\n  ])\n\n  useEffect(() => {\n    if (textRefValue !== defaultValue) {\n      updateText(defaultValue)\n    }\n  }, [\n    textRefValue,\n    defaultValue,\n    updateText,\n  ])\n\n  const handleTextChange = useCallback((event) => {\n    let value = event.target.innerHTML || ''\n    // .replace(/&emsp;/g, '\\t')\n    // .replace(/&lt;/g, '<')\n    // .replace(/&gt;/g, '>')\n\n    if (linebreaks === false) {\n      value = value.replace(/<\\/? ?br ?\\/?>/g, ' ')\n    } else {\n      value = value.replace(/<\\/? ?br ?\\/?>/g, '\\n')\n    }\n\n    value = value.trim()\n    textRef.current = value\n\n    if (onChange) {\n      onChange(value)\n    }\n  }, [onChange, linebreaks])\n\n  const handleTextBlur = useCallback(() => {\n    if (onBlur) {\n      onBlur(textRefValue)\n    }\n  }, [onBlur, textRefValue])\n\n  const keyDownHandler = useCallback(event => {\n    if (event.key === 'Enter' && event.shiftKey === true) {\n      // source: StackOverflow (https://stackoverflow.com/a/61237402)\n      if (linebreaks !== false) {\n        document.execCommand('insertLineBreak')\n      }\n      event.preventDefault()\n    } else if (event.key === 'Tab') {\n      document.execCommand('insertText', false, '\\t')\n      event.preventDefault()\n    } else if (event.key === 'ArrowUp') {\n      if (onGoToPrevInput) {\n        const caret = getCaretPosition(inputRef.current)\n        if (caret.inFirstLine) {\n          onGoToPrevInput({ caret })\n          event.preventDefault()\n        }\n      }\n    } else if (event.key === 'ArrowLeft') {\n      if (onGoToPrevInput) {\n        const caret = getCaretPosition(inputRef.current)\n        if (caret.inFirstLine && caret.positionFromStart <= 0) {\n          caret.positionFromLineStart = -1\n          onGoToPrevInput({ caret })\n          event.preventDefault()\n        }\n      }\n    } else if (event.key === 'ArrowDown') {\n      if (onGoToNextInput) {\n        const caret = getCaretPosition(inputRef.current)\n        if (caret.inLastLine) {\n          onGoToNextInput({ caret })\n          event.preventDefault()\n        }\n      }\n    } else if (event.key === 'ArrowRight') {\n      if (onGoToNextInput) {\n        const caret = getCaretPosition(inputRef.current)\n        if (caret.inLastLine && caret.positionFromEnd === 0) {\n          caret.positionFromLineStart = 0\n          onGoToNextInput({ caret })\n          event.preventDefault()\n        }\n      }\n    } else if (event.key === 'Enter') {\n      if (type === 'code') {\n        if (linebreaks !== false) {\n          document.execCommand('insertLineBreak')\n        }\n        event.preventDefault()\n      } else {\n        if (onSplitText) {\n          const caret = getCaretPosition(inputRef.current)\n\n          const innerText = inputRef.current.innerText\n          const start = innerText.slice(0, caret.positionFromStart)\n          const end = innerText.slice(caret.positionFromStart)\n\n          onSplitText({\n            texts: [start, end],\n          })\n          event.preventDefault()\n        }\n      }\n    } else if (event.key === 'Backspace') {\n      if (onMergeToPrevInput) {\n        const caret = getCaretPosition(inputRef.current)\n        if (caret.positionFromStart === 0 && caret.inFirstLine) {\n          onMergeToPrevInput({\n            caret,\n            text: inputRef.current.innerText,\n          })\n          event.preventDefault()\n        }\n      }\n    } else if (event.key === 'Delete') {\n      if (onMergeFromNextInput) {\n        const caret = getCaretPosition(inputRef.current)\n        if (caret.positionFromEnd === 0 && caret.inLastLine) {\n          onMergeFromNextInput({\n            caret,\n            text: inputRef.current.innerText,\n          })\n          event.preventDefault()\n        }\n      }\n    }\n  }, [\n    inputRef,\n    linebreaks,\n    onGoToPrevInput,\n    onGoToNextInput,\n    onSplitText,\n    onMergeToPrevInput,\n    onMergeFromNextInput,\n    type,\n  ])\n\n  useEffect(() => {\n    if (onInputRef) {\n      onInputRef(inputRef)\n    }\n  }, [onInputRef, inputRef])\n\n  const handlePaste = useCallback(event => {\n    // only accept plain text\n\n    // cancel paste\n    event.preventDefault()\n\n    // get text representation of clipboard\n    let text = (event.originalEvent || event).clipboardData.getData('text/plain')\n\n    if (linebreaks === false) {\n      text = text.replace(/\\n/g, ' ')\n    }\n\n    // insert text manually\n    document.execCommand('insertText', false, text)\n  }, [linebreaks])\n\n  // const highlighted = hljs.highlightAuto(text, { ignoreIllegals: true })\n  // language\n  //   ? hljs.highlight(language, content)\n  //   : hljs.highlightAuto(content)\n\n  return <>\n  <div\n    ref={inputRef}\n    onKeyDown={keyDownHandler}\n    onInput={handleTextChange}\n    onBlur={handleTextBlur}\n    onPaste={handlePaste}\n    className={`${classes.rebuild_textarea} ${textRefValue.length === 0 ? classes.show_placeholder : ''} ${className}`}\n    contentEditable={true}\n    dangerouslySetInnerHTML={fakeDefaultValue}\n    style={style}\n    placeholder={placeholder}\n  />\n    {/* <pre className=\"hljs\">\n      <code dangerouslySetInnerHTML={{ __html: highlighted.value }} />\n    </pre> */}\n  </>\n}\n\nexport default HtmlInput\n","import React, { useEffect, useState, useCallback }from 'react'\n\nimport {\n  Modal,\n} from '@mui/material'\nimport {\n  QrCodeSharp as QrCodeIcon,\n  AssessmentSharp as AssessmentIcon,\n  ContentCopySharp as CopyIcon,\n} from '@mui/icons-material'\n\nimport { Localized } from '../../fluent/Localized.js' // useLocalization\n\nimport classes from './SharingEditor.module.css'\n\nimport HtmlInput from './HtmlInput.js'\n\nfunction fallbackCopyTextToClipboard(text) {\n  // Source: https://stackoverflow.com/questions/400212/how-do-i-copy-to-the-clipboard-in-javascript\n  var textArea = document.createElement(\"textarea\");\n  textArea.value = text;\n\n  // Avoid scrolling to bottom\n  textArea.style.top = \"0\";\n  textArea.style.left = \"0\";\n  textArea.style.position = \"fixed\";\n\n  document.body.appendChild(textArea);\n  textArea.focus();\n  textArea.select();\n\n  try {\n    var successful = document.execCommand('copy');\n    var msg = successful ? 'successful' : 'unsuccessful';\n    console.info('Fallback: Copying text command was ' + msg);\n  } catch (err) {\n    console.error('Fallback: Oops, unable to copy', err);\n  }\n\n  document.body.removeChild(textArea);\n}\n\nfunction copyTextToClipboard(text) {\n  // Source: https://stackoverflow.com/questions/400212/how-do-i-copy-to-the-clipboard-in-javascript\n  if (!navigator.clipboard) {\n    fallbackCopyTextToClipboard(text);\n    return;\n  }\n  navigator.clipboard.writeText(text).then(function() {\n    console.info('Async: Copying to clipboard was successful!');\n  }, function(err) {\n    console.error('Async: Could not copy text: ', err);\n  });\n}\n\nfunction SharingEditor({\n  defaultBlock = {},\n  open = false,\n  onChange,\n  onClose,\n}) {\n  const [ slug, setSlug ] = useState('')\n\n  useEffect(() => {\n    const properties = defaultBlock.properties || {}\n    const initialSlug = properties.slug || ''\n\n    setSlug(initialSlug)\n  }, [defaultBlock, setSlug ])\n\n  const saveSlug = useCallback(newSlug => {\n    const newProperties = {...(defaultBlock.properties || {})}\n\n    if (newSlug === '') {\n      if (newProperties.hasOwnProperty('slug')) {\n        delete newProperties.slug\n      }\n    } else {\n      newProperties.slug = newSlug\n    }\n\n    setSlug(newSlug)\n    onChange(newProperties)\n  }, [\n    defaultBlock,\n    onChange,\n    setSlug,\n  ])\n\n  const viewStatistics = () => {\n    const a = document.createElement('a')\n    a.href = `https://umami.qiekub.org/share/s0ZHBZbb/volt.link?url=%2F${slug}`\n    a.target = '_blank'\n    a.rel = 'noreferrer'\n    a.click()\n  }\n\n  const gotoQrcodePage = () => {\n    const a = document.createElement('a')\n    a.href = `https://qrcode.volt.link/?c=volt.link/${slug}`\n    a.target = '_blank'\n    a.rel = 'noreferrer'\n    a.click()\n  }\n\n  const copyUrl = () => {\n    copyTextToClipboard(`https://volt.link/${slug}`)\n    alert('Copied to clipboard ')\n  }\n\n  if (!open) {\n    return null\n  }\n\n  return (\n    <Modal\n      open={open}\n      onClose={onClose}\n      hideBackdrop={true}\n    >\n      <>\n        <div className={classes.backdrop} onClick={onClose}></div>\n\n        <div className={classes.dialog}>\n\n            <h1 style={{ margin: '0 0 var(--basis_x4) 0' }}>Share the link</h1>\n            {/* <p>Enter @volteuropa.org addresses to give editing rights.<br/>Groups addresses are not supported.</p> */}\n\n            {/* <hr style={{ opacity: 0.2 }} /> */}\n\n            <div className={classes.inputWrapper}>\n             <span style={{ paddingRight: 'var(--basis)' }}>volt.link/</span>\n             <HtmlInput\n                defaultValue={slug}\n                onBlur={saveSlug}\n                linebreak={false}\n                className={classes.input}\n                style={{ margin: '0' }}\n              />\n            </div>\n\n            <hr style={{ opacity: 0.2 }} />\n\n            <div className={classes.actions}>\n              {\n                slug !== ''\n                ? <div>\n                    <button className=\"text hasIcon\" onClick={gotoQrcodePage} style={{ marginInlineStart: '0' }}>\n                      <QrCodeIcon className=\"icon\" />\n                      <span className=\"hideOnSmallScreen\"><Localized id=\"sharing_qrcode\" /></span>\n                    </button>\n                    <button className=\"text hasIcon\" onClick={viewStatistics}>\n                      <AssessmentIcon className=\"icon\" />\n                      <span className=\"hideOnSmallScreen\"><Localized id=\"sharing_statistics\" /></span>\n                    </button>\n                    <button className=\"text hasIcon\" onClick={copyUrl}>\n                      <CopyIcon className=\"icon\" />\n                      <span className=\"hideOnSmallScreen\"><Localized id=\"sharing_copy_url\" /></span>\n                    </button>\n                  </div>\n                : <div></div>\n              }\n\n              <button onClick={onClose} className=\"green\" style={{ marginInlineEnd: '0' }}>\n                <Localized id=\"dialog_done\" />\n              </button>\n            </div>\n        </div>\n      </>\n    </Modal>\n  )\n}\n\nexport default SharingEditor\n","import { useState, useCallback } from 'react'\n\nimport classes from './InputWithLocal.module.css'\nimport LocaleSelect from './LocaleSelect.js'\n\nfunction InputWithLocal({ reorderHandle, actionButton, locale, defaultValue, children, style, onChange, onBlur, className, dataset = {}, ...props }) {\n  const [changedLocale, setChangedLocale] = useState(locale)\n  const [changedText, setChangedText] = useState(defaultValue)\n\n  const handleBlur = useCallback(() => {\n    if (onBlur) {\n      onBlur({\n        value: {\n          locale: changedLocale,\n          text: changedText,\n        },\n        dataset,\n      })\n    }\n  }, [ onBlur, changedLocale, changedText, dataset ])\n\n  const handleLocaleChange = useCallback(newLocale => {\n    setChangedLocale(newLocale)\n\n    const changes = {\n      value: {\n        locale: newLocale,\n        text: changedText,\n      },\n      dataset,\n    }\n\n    if (onChange) {\n      onChange(changes)\n    }\n    if (onBlur) {\n      onBlur(changes)\n    }\n  }, [setChangedLocale, onChange, changedText, dataset, onBlur])\n\n  const handleTextChange = useCallback((event_or_text) => {\n    let text = event_or_text\n    if (\n      !!event_or_text\n      && !!event_or_text.target\n      && !!event_or_text.target.value\n    ) {\n      text = event_or_text.target.value\n    }\n\n    setChangedText(text)\n    if (onChange) {\n      onChange({\n        value: {\n          locale: changedLocale,\n          text,\n        },\n        dataset,\n      })\n    }\n  }, [setChangedText, onChange, changedLocale, dataset])\n\n  return <div\n    className={classes.input_with_local+' '+className}\n    style={style}\n  >\n    <LocaleSelect\n      onChange={handleLocaleChange}\n      defaultValue={locale}\n    />\n    {\n      !!children\n        ? children({\n          onChange: handleTextChange,\n          onBlur: handleBlur,\n          defaultValue,\n          style: {\n            flexGrow: '1',\n          }\n        })\n        : null\n    }\n  </div>\n}\n\nexport default InputWithLocal\n","import { useState, useCallback, useEffect } from 'react'\n\nimport { DragDropContext, Droppable, Draggable } from 'react-beautiful-dnd'\n\nimport { v4 as uuidv4 } from 'uuid'\n\nimport classes from './Repeater.module.css'\n\nimport DragIndicatorIcon from '@mui/icons-material/DragIndicator'\n\nfunction reorder(list, startIndex, endIndex) {\n  const result = Array.from(list)\n  const [removed] = result.splice(startIndex, 1)\n  result.splice(endIndex, 0, removed)\n\n  return result\n}\n\nfunction Row({\n  subDefaultValue,\n  index,\n  render,\n  handleRowChange,\n  isReorderable,\n  handleAddRow,\n  handleRemoveRow,\n  showReorderControls,\n  reorderLabel,\n  showActionButton,\n  hasOnlyOneRow,\n  addRowByIndex,\n}) {\n  return <Draggable\n      key={subDefaultValue.tmp_id}\n      draggableId={subDefaultValue.tmp_id}\n      index={index}\n      isDragDisabled={isReorderable === true ? false : true}\n      disableInteractiveElementBlocking={true}\n      shouldRespectForcePress={true}\n    >\n      {provided => (\n        <div\n          ref={provided.innerRef}\n          {...provided.draggableProps}\n\n          key={subDefaultValue.tmp_id}\n          className={classes.row}\n        >\n          {/*\n            index !== 0\n            ? <div className={classes.middleActions}>\n              <div className={classes.trigger}></div>\n              <div className={classes.content}>\n                <button className={`green ${classes.inlineRowButton}`} data-index={index} onClick={handleAddRow}>+</button>\n              </div>\n            </div>\n            : null\n          */}\n\n        <div className={classes.form}>\n          {\n            isReorderable === true && showReorderControls === true\n              ? <button\n                  aria-label={reorderLabel}\n                  className={`text ${classes.inlineRowButton} ${classes.dragHandleButton}`}\n                  {...provided.dragHandleProps}\n                >\n                  <DragIndicatorIcon />\n                </button>\n              : null\n          }\n          {\n            render({\n              key: subDefaultValue.tmp_id,\n              defaultValue: subDefaultValue,\n              className: classes.item,\n              dataset: {\n                'data-index': index,\n                'data-id': subDefaultValue.tmp_id,\n              },\n              onChange: handleRowChange,\n              onRemoveRow: () => handleRemoveRow(index),\n              addRowBefore: (newValue) => addRowByIndex(index, 0, newValue),\n              addRowAfter: (newValue) => addRowByIndex(index, 1, newValue),\n              reorderHandle: <button\n                  aria-label={reorderLabel}\n                  className={`text ${classes.inlineRowButton} ${classes.dragHandleButton}`}\n                  {...provided.dragHandleProps}\n                >\n                  <DragIndicatorIcon />\n                </button>,\n              actionButton: (\n                hasOnlyOneRow\n                  ? <button className={`green ${classes.inlineRowButton}`} onClick={handleAddRow}>+</button>\n                  : <button className={`red ${classes.inlineRowButton}`} data-index={index} onClick={handleRemoveRow}></button>\n              ),\n            })\n          }\n          {\n            showActionButton === true\n            ? (\n            hasOnlyOneRow\n              ? <button className={`green ${classes.inlineRowButton}`} onClick={handleAddRow}>+</button>\n              : <button className={`red ${classes.inlineRowButton}`} data-index={index} onClick={handleRemoveRow}></button>\n            )\n            : null\n          }\n        </div>\n      </div>\n    )}\n  </Draggable>\n}\n\nfunction getIndex(eventOrIndex) {\n  let index = eventOrIndex // for if it is a number/index\n\n  if (typeof eventOrIndex === 'object') {\n    if (!!eventOrIndex.target) { // is event\n      eventOrIndex = eventOrIndex.target\n    }\n    if (!!eventOrIndex.dataset) { // is only the dataset\n      if (!!eventOrIndex.dataset.index) {\n        index = parseInt(eventOrIndex.dataset.index)\n        if (isNaN(index)) {\n          index = null\n        }\n      }\n    }\n  }\n\n  return index\n}\n\nfunction Repeater({\n  defaultValue,\n  addDefaultValue,\n  addButtonText,\n  hideAddButton = false,\n  reorderLabel = 'Reorder',\n  render,\n  style,\n  onChange,\n  prependNewItems,\n  showReorderControls = false,\n  showActionButton = true,\n  isReorderable = false\n}) {\n  if (!(!!addButtonText)) {\n    addButtonText = 'Add Row'\n  }\n\n  const [rows, setRows] = useState([])\n\n  const internalAddDefaultValue = useCallback(() => {\n    let tmp_defaultValue = {}\n    if (typeof addDefaultValue === 'function') {\n      const defaultValue = addDefaultValue()\n      if (typeof defaultValue === 'object' && defaultValue !== null) {\n        tmp_defaultValue = defaultValue\n        if (\n          typeof tmp_defaultValue.tmp_id !== 'string'\n          || tmp_defaultValue.tmp_id === ''\n        ) {\n          tmp_defaultValue.tmp_id = uuidv4()\n        }\n      }\n    }\n    return tmp_defaultValue\n  }, [addDefaultValue])\n\n  useEffect(() => {\n    let tmp_defaultValue = defaultValue\n    if (!Array.isArray(defaultValue) || defaultValue.length === 0) {\n      tmp_defaultValue = [internalAddDefaultValue()]\n    }\n    tmp_defaultValue = tmp_defaultValue.map(item => {\n      if (!item.tmp_id) {\n        return { ...item, tmp_id: uuidv4() }\n      }\n      return item\n    })\n    setRows(tmp_defaultValue)\n  }, [defaultValue, internalAddDefaultValue, setRows])\n\n  const handleRemoveRow = useCallback(eventOrIndex => {\n    const index = getIndex(eventOrIndex)\n\n    let new_rows = [...rows]\n    new_rows.splice(index, 1)\n    const rows_from_onChange = onChange(new_rows)\n    if (Array.isArray(rows_from_onChange)) {\n      new_rows = rows_from_onChange\n    }\n    setRows(new_rows)\n  }, [rows, setRows, onChange])\n\n  const handleRowChange = useCallback(event => {\n    const index = event.dataset.index || event.dataset['data-index']\n    const tmp_id = event.dataset.id || event.dataset['data-id']\n    const newValue = event.value\n\n    const new_rows = [...rows]\n    if (typeof newValue !== 'object' || newValue === null || Array.isArray(newValue)) {\n      new_rows[index] = {\n        tmp_id,\n        value: newValue\n      }\n    } else if (typeof newValue === 'object') {\n      new_rows[index] = {\n        tmp_id,\n        ...newValue\n      }\n    }\n    setRows(new_rows)\n    onChange(new_rows)\n  }, [rows, setRows, onChange])\n\n  const addRowByIndex = useCallback((index, offset = 0, newValue) => {\n    if (typeof newValue === 'object') {\n      newValue = {\n        ...(internalAddDefaultValue()),\n        ...newValue,\n      }\n    } else {\n      newValue = newValue || internalAddDefaultValue()\n    }\n\n    let new_rows = null\n    if (index !== null && index >= 0) {\n      new_rows = [...rows]\n      new_rows.splice(index + offset, 0, newValue)\n    }\n\n    setRows(new_rows)\n    onChange(new_rows)\n  }, [rows, internalAddDefaultValue, setRows, onChange])\n\n  const handleAddRow = useCallback(eventOrIndex => {\n    const newValue = internalAddDefaultValue()\n\n    const index = getIndex(eventOrIndex)\n\n    let new_rows = null\n    if (index !== null && index >= 0) {\n      new_rows = [...rows]\n      new_rows.splice(index, 0, newValue)\n    } else {\n      if (prependNewItems === true) {\n        new_rows = [newValue, ...rows]\n      } else {\n        new_rows = [...rows, newValue]\n      }\n    }\n\n    setRows(new_rows)\n    onChange(new_rows)\n  }, [rows, internalAddDefaultValue, setRows, onChange, prependNewItems])\n\n  function onDragEnd(result) {\n    if (!result.destination) {\n      return\n    }\n\n    if (result.destination.index === result.source.index) {\n      return\n    }\n\n    const new_rows = reorder(\n      rows,\n      result.source.index,\n      result.destination.index\n    )\n    setRows(new_rows)\n    onChange(new_rows)\n  }\n\n  const hasOnlyOneRow = rows.length === 1\n\n  const addButton = <div style={{ textAlign: 'right' }}>\n    <button className={`green ${classes.addRowButton}`} onClick={handleAddRow}>{addButtonText}</button>\n  </div>\n\n  return <div style={style}>\n    {hideAddButton === false && (!hasOnlyOneRow && prependNewItems) ? <div style={{ marginBottom: 'var(--basis)' }}>{addButton}</div> : null}\n\n    <DragDropContext onDragEnd={onDragEnd}>\n      <Droppable\n        droppableId=\"list\"\n        isDropDisabled={isReorderable === true ? false : true}\n      >\n        {provided => (\n          <div ref={provided.innerRef} {...provided.droppableProps}>\n            {\n              rows\n              .filter(subDefaultValue => subDefaultValue.tmp_id)\n              .map(\n                (subDefaultValue, index) => <Row\n                  key={subDefaultValue.tmp_id}\n                  {...{\n                    subDefaultValue,\n                    index,\n                    render,\n                    handleRowChange,\n                    isReorderable,\n                    handleAddRow,\n                    handleRemoveRow,\n                    showReorderControls,\n                    reorderLabel,\n                    showActionButton,\n                    hasOnlyOneRow,\n                    addRowByIndex,\n                  }}\n                />\n              )\n            }\n            {provided.placeholder}\n          </div>\n        )}\n      </Droppable>\n    </DragDropContext>\n\n    {hideAddButton === false && (!hasOnlyOneRow && !prependNewItems) ? addButton : null}\n  </div>\n}\n\nexport default Repeater\n","import React, { useEffect, useState, useCallback } from 'react'\n\nimport {\n  Modal,\n} from '@mui/material'\n\nimport { Localized } from '../../fluent/Localized.js' // useLocalization\n\nimport classes from './TranslationEditor.module.css'\n\nimport HtmlInput from './HtmlInput.js'\nimport InputWithLocal from './InputWithLocal.js'\nimport ViewerAuto from '../view/ViewerAuto.js'\nimport LocaleSelect from './LocaleSelect.js'\nimport Repeater from '../Repeater.js'\n\nimport useSaveBlock from '../../hooks/useSaveBlock.js'\nimport useLoadBlocks from '../../hooks/useLoadBlocks.js'\n\nfunction SimpleTranslationRepeater({ onSaveProperty, block, isFirst }) {\n\n  const addDefaultValue = () => ({\n    locale: null,\n    text: '',\n  })\n\n  let translations = block.properties.translations || []\n  if (translations.length === 0) {\n    translations = [addDefaultValue]\n  }\n\n  const onRepeaterChange = useCallback(newTranslations => {\n    newTranslations = newTranslations\n      .map(translation => ({\n        locale: translation.locale || null,\n        text: translation.text || '',\n      }))\n\n    onSaveProperty('translations', newTranslations)\n  }, [ onSaveProperty ])\n\n  const onBlockLocaleChange = useCallback(newLocale => {\n    onSaveProperty('locale', newLocale)\n  }, [ onSaveProperty ])\n\n  const block2display = { ...block }\n  if (isFirst === true && block2display.type === 'page') {\n    block2display.type = 'text'\n    block2display.properties.text_style = 'h1'\n  }\n\n  return <div style={{\n    width: '100%',\n  }}>\n\n    <div style={{\n      display: 'flex',\n      alignItems: 'flex-end',\n      marginBottom: 'var(--basis)',\n      gap: 'var(--basis)',\n    }}>\n      <LocaleSelect\n        onChange={onBlockLocaleChange}\n        defaultValue={block.properties.locale || null}\n      />\n\n      <ViewerAuto\n        block={block2display}\n        style={{\n          margin: '0',\n          minHeight: '30px',\n        }}\n        clickable={false}\n      />\n    </div>\n\n    <Repeater\n      onChange={onRepeaterChange}\n      defaultValue={translations}\n      addDefaultValue={addDefaultValue}\n      addButtonText=\"+\"\n      render={\n        ({ defaultValue, ...repeater_props }) => {\n          const {\n            onChange,\n            ...other_repeater_props\n          } = repeater_props\n\n          const locale = defaultValue.locale\n          const text = defaultValue.text\n          return <InputWithLocal\n            onBlur={onChange}\n            locale={locale}\n            defaultValue={text}\n            style={{\n              marginBottom: 'var(--basis)',\n            }}\n            {...other_repeater_props}\n          >\n            {InputWithLocal_props => <HtmlInput\n              {...InputWithLocal_props}\n              style={{\n                ...InputWithLocal_props.style,\n                margin: '0',\n              }}\n            />}\n          </InputWithLocal>\n        }\n      }\n    />\n  </div>\n}\n\nfunction TranslationEditor({\n  defaultBlock = {},\n  open = false,\n  onSaveProperty, // to not overwrite the translatins by the PageEditor\n  onClose,\n}) {\n\n  const [blocks, setBlocks] = useState([])\n\n  const loadBlocks = useLoadBlocks()\n  useEffect(() => {\n    async function loadContentBlocks () {\n      const ids2load = [\n        ...defaultBlock.content\n          .filter(contentConfig =>\n            contentConfig.hasOwnProperty('blockId')\n            && contentConfig.hasOwnProperty('block')\n          )\n          .map(contentConfig => contentConfig.blockId || contentConfig.block._id),\n      ]\n\n      let loadedBlocks = []\n      if (ids2load.length > 0) {\n        loadedBlocks = await loadBlocks({ ids: ids2load })\n      }\n\n      let contentBlocks = ids2load.map(id => { // map to the ids to keep the order\n        const block = loadedBlocks.find(block => block._id === id)\n        if (\n          block\n          && block.type !== 'divider'\n          && !!block.properties.text\n        ) {\n          return block\n        } else {\n          return null\n        }\n      })\n      .filter(Boolean) // remove null values\n\n      return contentBlocks\n    }\n\n    if (blocks.length === 0) {\n      loadContentBlocks()\n        .then(contentBlocks => {\n          const newBlocks = [\n            defaultBlock,\n            ...contentBlocks,\n          ]\n\n          setBlocks(newBlocks)\n        })\n    } else if (JSON.stringify(defaultBlock) !== JSON.stringify(blocks[0])) {\n      // replace the first block of blocks with defaultBlock\n      setBlocks([\n        defaultBlock,\n        ...blocks.slice(1),\n      ])\n    }\n  }, [ defaultBlock, loadBlocks, setBlocks, blocks ])\n\n  const saveBlock = useSaveBlock()\n  const onSaveChildProperty = useCallback((block, key, value) => {\n    const newBlock = {\n      ...block,\n      properties: {\n        ...block.properties,\n        [key]: value,\n      },\n    }\n\n    saveBlock(newBlock)\n      .then(gottenBlock => { // only the id changed in gottenBlock      \n        const blockId = newBlock._id\n\n        // find the block in the blocks array by _id\n        const blockIndex = blocks.findIndex(block => block._id === blockId)\n        \n        // replace the block at blockIndex in the blocks array by newBlock\n        const newBlocks = [\n          ...blocks.slice(0, blockIndex),\n          newBlock,\n          ...blocks.slice(blockIndex + 1),\n        ]\n\n        setBlocks(newBlocks)\n      })\n  }, [ saveBlock, blocks, setBlocks ])\n\n  if (!open) {\n    return null\n  }\n\n  return (\n    <Modal\n      open={open}\n      onClose={onClose}\n      hideBackdrop={true}\n      style={{\n        zIndex: '1000',\n      }}\n    >\n      <>\n        <div className={classes.backdrop} onClick={onClose}></div>\n\n        <div className={classes.dialog}>\n\n          \n          <div className={classes.actions}>\n            <h1 style={{ margin: '0 0 var(--basis_x4) 0' }}>\n              <Localized id=\"translate_dialog_title\" />\n            </h1>\n            <button onClick={onClose} className=\"green\" style={{ marginInlineEnd: '0' }}>\n              <Localized id=\"dialog_done\" />\n            </button>\n          </div>\n          <p>\n            <Localized id=\"translate_dialog_description\" />\n          </p>\n\n          <hr style={{ opacity: 0.2 }} />\n\n          {\n            blocks\n            .flatMap((block, index) => ([\n              <hr key={'hr-'+index} style={{ opacity: 0 }} />,\n              <div key={'div-'+index} style={{ margin: 'var(--basis_x4) 0' }}>\n                <SimpleTranslationRepeater\n                  onSaveProperty={\n                    block._id === defaultBlock._id\n                    ? onSaveProperty\n                    : (...attr) => onSaveChildProperty(block, ...attr)\n                  }\n                  block={block}\n                  isFirst={index === 0}\n                />\n              </div>\n            ]))\n          }\n\n          <hr style={{ opacity: 0.2 }} />\n\n          <div className={classes.actions}>\n            <div></div>\n            <button onClick={onClose} className=\"green\" style={{ marginInlineEnd: '0' }}>\n              <Localized id=\"dialog_done\" />\n            </button>\n          </div>\n        </div>\n      </>\n    </Modal>\n  )\n}\n\nexport default TranslationEditor\n","import { useState } from 'react'\n\nimport classes from './FancyInput.module.css'\n\nfunction FancyInput({ children, className, style, ...props }) {\n  const [error, setError] = useState('')\n\n  return <div\n    className={className}\n    style={style}\n  >\n    {children({ setError })}\n    {\n      error\n      ? <div className={classes.error}>\n          {error.split('\\n').map(error => <p key={error}>{error}</p>)}\n        </div>\n      : null\n    }\n  </div>\n}\n\nexport default FancyInput\n","import { useCallback } from 'react'\n\nconst email_regex = /^(?:(?:[^<>()[\\]\\\\.,;:\\s@\"]+(?:\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(?:\".+\"))@(?:(?:\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3})|(?:(?:[a-zA-Z0-9-]+\\.)+[a-zA-Z]{2,})\\.?)$/gui // is surrounded by start and end tags\nconst emails_regex = /((?:(?:[^<>()[\\]\\\\.,;:\\s@\"]+(?:\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(?:\".+\"))@(?:(?:\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3})|(?:(?:[a-zA-Z0-9-]+\\.)+[a-zA-Z]{2,})\\.?))/gui // is surrounded by a group\n\nfunction EmailInput({ multiple = false, onChange, onError, ...props }) {\n  const handleTextChange = useCallback((event) => {\n    if (onChange ||onError) {\n      let value = event.target.value ||''\n      let isSubmittable = false\n      let error = ''\n\n      if (value !== '') {\n        if (multiple === true) {\n          const emails = value.match(emails_regex)\n          if (emails) {\n            value = emails\n            isSubmittable = true\n          } else {\n            error = 'Invalid email(s) format'\n          }\n        } else {\n          if (value.match(email_regex)) {\n            isSubmittable = true\n          } else {\n            error = 'invalid_email'\n          }\n        }\n      }\n\n      if (onChange) {\n        if (isSubmittable) {\n          onChange(value)\n        } else {\n          if (multiple === true) {\n            onChange([])\n          } else {\n            onChange('')\n          }\n        }\n      }\n\n      if (onError) {\n        onError(error)\n      }\n    }\n  }, [multiple, onChange, onError])\n\n  return <input\n    type=\"email\"\n    onChange={handleTextChange}\n    {...props}\n  />\n}\n\nexport default EmailInput\n","import React, { useState, useCallback, useEffect } from 'react'\n\nimport {\n  Modal,\n  Menu,\n  MenuItem,\n  Divider,\n  ListItemIcon,\n  ListItemText,\n} from '@mui/material'\nimport {\n  KeyboardArrowDown as KeyboardArrowDownIcon,\n  Delete as DeleteIcon,\n  Close as CloseIcon,\n  Visibility as ViewerIcon,\n  Edit as EditorIcon,\n  Lock as NoAccessIcon,\n} from '@mui/icons-material'\nimport { v4 as uuidv4 } from 'uuid'\n\nimport { Localized, useLocalization } from '../../fluent/Localized.js'\n\nimport useUser from '../../hooks/useUser.js'\n\nimport FancyInput from './FancyInput.js'\nimport EmailInput from './EmailInput.js'\n\nimport classes from './PermissionsEditor.module.css'\n\nfunction addTmpIds(array) {\n  return [...array].map(obj => {\n    const obj_new = { ...obj }\n    obj_new.tmp_id = uuidv4()\n    return obj_new\n  })\n}\n\nfunction LocalizedRole({ role }) {\n  return <Localized id={'role_'+role} />\n}\n\nfunction RolesMenu({\n  role,\n  trigger,\n  changeRole,\n  removePermission,\n}){\n  const [anchorEl, setAnchorEl] = React.useState(null)\n  const open = Boolean(anchorEl)\n  const handleOpen = event => {\n    setAnchorEl(event.currentTarget)\n  }\n  const handleClose = () => {\n    setAnchorEl(null)\n  }\n\n  return <>\n    {trigger({\n      onClick: handleOpen,\n    })}\n\n    <Menu\n      anchorEl={anchorEl}\n      open={open}\n      onClose={handleClose}\n      MenuListProps={{\n        style: {\n          maxWidth: '100%',\n          background: 'var(--background-contrast)',\n          color: 'var(--on-background)',\n        },\n      }}\n    >\n      <MenuItem\n        disabled={role === 'viewer'}\n        onClick={() => changeRole('viewer')}\n        className=\"roundMenuItem\"\n      >\n        <ListItemIcon>\n          <ViewerIcon />\n        </ListItemIcon>\n        <ListItemText>\n          <LocalizedRole role=\"viewer\" />\n        </ListItemText>\n      </MenuItem>\n      <MenuItem\n        disabled={role === 'editor'}\n        onClick={() => changeRole('editor')}\n        className=\"roundMenuItem\"\n      >\n        <ListItemIcon>\n          <EditorIcon />\n        </ListItemIcon>\n        <ListItemText>\n          <LocalizedRole role=\"editor\" />\n        </ListItemText>\n      </MenuItem>\n      <MenuItem\n        disabled={role === 'no_access'}\n        onClick={() => changeRole('no_access')}\n        className=\"roundMenuItem\"\n      >\n        <ListItemIcon>\n          <NoAccessIcon />\n        </ListItemIcon>\n        <ListItemText>\n          <LocalizedRole role=\"no_access\" />\n        </ListItemText>\n      </MenuItem>\n      \n        {\n          typeof removePermission === 'function'\n          ? <div>\n            <Divider style={{ opacity: 0.2, margin: '8px 0' }} />\n            <MenuItem\n              onClick={removePermission}\n              className=\"roundMenuItem\"\n            >\n              <ListItemIcon>\n                <DeleteIcon />\n              </ListItemIcon>\n              <ListItemText>\n                Remove\n              </ListItemText>\n            </MenuItem>\n          </div>\n          : null\n        }\n\n        <Divider style={{ opacity: 0.2, margin: '8px 0' }} />\n\n        <MenuItem\n          onClick={handleClose}\n          className=\"roundMenuItem\"\n        >\n          <ListItemIcon>\n            <CloseIcon />\n          </ListItemIcon>\n          <ListItemText>\n            Close\n          </ListItemText>\n        </MenuItem>\n    </Menu>\n  </>\n}\n\nfunction sortPermissions(permissions) {\n  const owner = permissions\n    .filter(p => p.role === 'owner')\n    .sort((a, b) => a.email.localeCompare(b.email))\n\n  const special = permissions\n    .filter(p => p.email === '@volteuropa.org' || p.email === '@public')\n    .sort((a, b) => a.email.localeCompare(b.email))\n\n  const other = permissions\n    .filter(p => p.role !== 'owner' && p.email !== '@volteuropa.org' && p.email !== '@public')\n    .sort((a, b) => a.email.localeCompare(b.email))\n\n  return [\n    ...owner,\n    ...special,\n    ...other,\n  ]\n}\n\nfunction PermissionsEditor({\n  defaultPermissions,\n  open = false,\n  onChange,\n  onClose,\n}) {\n  const { getString } = useLocalization()\n\n  const user_data = useUser()\n  let user_email = ''\n  if (!!user_data) {\n    if (!!user_data.user) {\n      if (!!user_data.user.email) {\n        user_email = user_data.user.email\n      }\n    }\n  }\n\n  const [inputRepaintKey, setInputRepaintKey] = useState(0)\n  const [permissions, setPermissions] = useState([])\n  const [newEmails, setNewEmails] = useState([])\n  const [newRole, setNewRole] = useState('editor')\n\n  const setNewPermission = useCallback(newPermissions => {\n    newPermissions = addTmpIds(newPermissions || [])\n\n    if (user_email !== '') {\n      const doesNotHaveOwner = newPermissions.filter(permission => permission.role === 'owner').length === 0\n      if (doesNotHaveOwner) {\n        newPermissions.unshift({ tmp_id: uuidv4(), email: user_email, role: 'owner' })\n      }\n    }\n    \n    setPermissions(newPermissions)\n  }, [ user_email, setPermissions ])\n\n  useEffect(() => {\n    const blockPermissions = defaultPermissions['/']\n    if (Array.isArray(blockPermissions)) {\n      setNewPermission(blockPermissions)\n    } else {\n      setNewPermission([])\n    }\n  }, [ setNewPermission, defaultPermissions ])\n\n  const removePermission = useCallback(email => {\n    let newPermissions = permissions.filter(p => p.email !== email)\n    if (email === '@volteuropa.org') {\n      newPermissions = newPermissions.filter(p => p.email !== '@public')\n    }\n\n    const doesNotHaveOwner = newPermissions.filter(p => p.role === 'owner').length === 0\n    if (doesNotHaveOwner) {\n      newPermissions = newPermissions.filter(p => p.email !== user_email)\n      newPermissions.unshift({ tmp_id: uuidv4(), email: user_email, role: 'owner' })\n    }\n\n    setPermissions(newPermissions)\n    onChange({ '/': newPermissions })\n  }, [permissions, user_email, setPermissions, onChange])\n\n  const changeRole = useCallback((email, newRole) => {\n    const newPermissions = permissions.map(permission => {\n      if (permission.email === email) {\n        return {\n          ...permission,\n          role: newRole,\n        }\n      }\n      return permission\n    })\n\n    setPermissions(newPermissions)\n    onChange({ '/': newPermissions })\n  }, [permissions, setPermissions, onChange])\n\n  const addPermissions = useCallback((newEmails, newRole) => {\n    if (newEmails.includes('@public')) {\n      newEmails.push('@volteuropa.org')\n    }\n    let newPermissions = permissions.filter(permission => !newEmails.includes(permission.email))\n    for (const newEmail of newEmails) {\n      newPermissions.unshift({ tmp_id: uuidv4(), email: newEmail, role: newRole })\n    }\n\n    const doesNotHaveOwner = newPermissions.filter(p => p.role === 'owner').length === 0\n    if (doesNotHaveOwner) {\n      newPermissions = newPermissions.filter(p => p.email !== user_email)\n      newPermissions.unshift({ tmp_id: uuidv4(), email: user_email, role: 'owner' })\n    }\n\n    setPermissions(newPermissions)\n    onChange({ '/': newPermissions })\n  }, [permissions, user_email, setPermissions, onChange])\n\n  const addNewPermissionFromInput = useCallback(() => {\n    addPermissions(newEmails, newRole)\n    setNewEmails([]) // reset the email-input | don't reset the role-input so it can be reused when entering multiple emails after each other // setNewRole('editor')\n    setInputRepaintKey(oldInputRepaintKey => oldInputRepaintKey + 1) // redraw the email-input\n  }, [ newEmails, newRole, addPermissions ])\n\n  if (!open) {\n    return null\n  }\n\n  const doesNotHaveVoltEuropa = permissions.filter(permission => permission.email === '@volteuropa.org').length === 0\n  const doesNotHavePublic = permissions.filter(permission => permission.email === '@public').length === 0\n\n  return (\n    <Modal\n      open={open}\n      onClose={onClose}\n      hideBackdrop={true}\n    >\n      <>\n        <div className={classes.backdrop} onClick={onClose}></div>\n\n        <div className={classes.dialog}>\n          <h1 style={{ margin: '0 0 var(--basis_x4) 0' }}>\n            <Localized id=\"permissions_dialog_title\" />\n          </h1>\n          <p>\n            <Localized id=\"permissions_dialog_description\" />\n          </p>\n          <div className={classes.inputWrapper} key={inputRepaintKey}>\n            <FancyInput className={classes.input}>\n              {({ setError }) => (\n                <EmailInput\n                  multiple={true}\n                  onError={setError}\n                  defaultValue=\"\"\n                  onChange={setNewEmails}\n                  aria-label={getString('path_editor_permissions_edit_label')}\n                  placeholder={getString('path_editor_permissions_edit_placeholder')}\n                  style={{\n                    flexGrow: '1',\n                    // margin: '0',\n                    margin: 'var(--basis) 0',\n                    width: 'calc(100% - var(--basis_x2))',\n                  }}\n                />\n              )}\n            </FancyInput>\n            <RolesMenu\n              role={newRole}\n              changeRole={setNewRole}\n              trigger={triggerProps => <button className={classes.menuButton} {...triggerProps}><LocalizedRole role={newRole} /> <KeyboardArrowDownIcon/></button>}\n            />\n          </div>\n\n          {\n            newEmails.length > 0 && newEmails[0].length > 0\n            ? <>\n                <hr />\n\n                <div className={classes.actions}>\n                  <div></div>\n                  <button onClick={addNewPermissionFromInput} className=\"green\" style={{margin: '0'}}>\n                    {\n                      newEmails.length > 1\n                      ? \"Add People\"\n                      : \"Add Person\"\n                    }\n                  </button>\n                </div>\n              </>\n            : <>\n                {\n                  doesNotHaveVoltEuropa || doesNotHavePublic\n                  ? <div style={{ marginTop: 'var(--basis_x2)' }}>\n                    Make visible for\n                    {\n                      doesNotHaveVoltEuropa\n                      ? <button onClick={() => addPermissions(['@volteuropa.org'], 'viewer')}>Volt Europa</button>\n                      : null\n                    }\n                    {\n                      doesNotHavePublic\n                      ? <button onClick={() => addPermissions(['@public'], 'viewer')}>Public</button>\n                      : null\n                    }\n                  </div>\n                  : null\n                }\n\n                {\n                  permissions.length === 0\n                   ? null\n                   : <hr style={{ opacity: 0.2 }} />\n                }\n\n                {\n                  sortPermissions(permissions)\n                  .map(p => <div key={p.tmp_id} className={classes.permissionRow}>\n                    {\n                      p.email === '@public'\n                        ? <strong>Public</strong>\n                        : (\n                          p.email === '@volteuropa.org'\n                            ? <strong>Volt Europa</strong>\n                            : <span>{p.email}</span>\n                        )\n                    }\n\n                    {\n                      p.role === 'owner'\n                      ? <strong className={`type_button ${classes.ownerInfo}`}><LocalizedRole role={p.role} /></strong>\n                      : <RolesMenu\n                          role={p.role}\n                          removePermission={() => removePermission(p.email)}\n                          changeRole={(newRole) => changeRole(p.email, newRole)}\n                          trigger={triggerProps => <button className={classes.menuButton} {...triggerProps}><LocalizedRole role={p.role} /> <KeyboardArrowDownIcon/></button>}\n                        />\n                    }\n                  </div>)\n                }\n\n                <hr style={{ opacity: 0.2 }} />\n\n                <div className={classes.actions}>\n                  <div></div>\n                  <button onClick={onClose} className=\"green\" style={{margin: '0'}}>\n                    <Localized id=\"dialog_done\" />\n                  </button>\n                </div>\n              </>\n          }\n        </div>\n      </>\n    </Modal>\n  )\n}\n\nexport default PermissionsEditor\n","import { useCallback, useState } from 'react'\n\nconst url_regex = /^([A-Z0-9+-.]+:(?:\\/\\/)?)[\\w\\u00C0-\\u00FF_.-]+(?:\\.[\\w\\u00C0-\\u00FF_.-]+)+[\\w\\u00C0-\\u00FF_~:/?#[\\]!%$&'()@*+,;=.-]+$/gui\nconst email_regex = /^(?:(?:[^<>()[\\]\\\\.,;:\\s@\"]+(?:\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(?:\".+\"))@(?:(?:\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3})|(?:(?:[a-zA-Z0-9-]+\\.)+[a-zA-Z]{2,})\\.?)$/gui\nconst is_email_not_url_regex = /^[^:/]+@.+$/gui\n\nfunction UrlInput({\n  defaultValue = '',\n  onChange,\n  onBlur,\n  onError,\n  placeholder = 'https://',\n  style,\n  className\n}) {\n  const [text, setText] = useState(defaultValue)\n\n  const handleTextChange = useCallback((event) => {\n    const value = event.target.value ||''\n    // let isSubmittable = false\n    let error = ''\n\n    if (value !== '') {\n      const schema_parts = value.split(':')\n      const schema = schema_parts.shift()\n      const after_schema = schema_parts.join(':')\n\n      if (schema === 'tel') {\n        // isSubmittable = true\n      } else if (schema === 'mailto' || value.match(is_email_not_url_regex)) {\n        if (after_schema.match(email_regex)) {\n          // isSubmittable = true\n        } else {\n          error = 'invalid_mailto_url'\n        }\n      } else {\n        if (value.match(url_regex)) {\n          // isSubmittable = true\n        } else {\n          error = 'invalid_url'\n        }\n      }\n    }\n\n    if (onChange) {\n      onChange(value)\n    }\n\n    if (onError) {\n      onError(error)\n    }\n\n    setText(value)\n  }, [onChange, onError])\n\n  const handleBlur = useCallback(() => {\n    if (onBlur) {\n      onBlur(text)\n    }\n  }, [onBlur, text])\n\n  return <input\n    type=\"url\"\n    onChange={handleTextChange}\n    onBlur={handleBlur}\n    defaultValue={defaultValue}\n    placeholder={placeholder}\n    style={style}\n    className={className}\n  />\n}\n\nexport default UrlInput\n","import React, { useState, useCallback, useRef } from 'react'\n\nimport classes from './StorageFileInput.module.css'\n\nfunction resize(file) {\n  return new Promise((resolve, reject) => {\n    const MAX_HEIGHT = 2000 // This is kinda arbitrary. But a limit is probably good.\n    const MAX_WIDTH = 2000 // This is kinda arbitrary. But a limit is probably good.\n\n    const image = new Image()\n    image.onload = function () {\n      const canvas = document.createElement('canvas')\n      if (image.height > MAX_HEIGHT) {\n        image.width *= MAX_HEIGHT / image.height\n        image.height = MAX_HEIGHT\n      }\n      if (image.width > MAX_WIDTH) {\n        image.height *= MAX_WIDTH / image.width\n        image.width = MAX_WIDTH\n      }\n      const ctx = canvas.getContext('2d')\n      ctx.clearRect(0, 0, canvas.width, canvas.height)\n      canvas.width = image.width\n      canvas.height = image.height\n      ctx.drawImage(image, 0, 0, image.width, image.height)\n    \n      const fileType = file.type || 'image/jpeg'\n\n      canvas.toBlob(newBlob => {\n        const resizedFile = new File([newBlob], file.name, {\n          type: fileType,\n          lastModified: file.lastModified || new Date(),\n        })\n        resolve(resizedFile)\n      }, fileType, 0.90) // to make the file a bit smaller\n    }\n    image.onerror = reject\n    const data_url = URL.createObjectURL(file)\n    image.src = data_url\n  })\n}\n\nfunction StorageFileInput({ onChange, onError, style }) {\n  const fileInputRef = useRef(null)\n\n  const [uploadProgressText, setUploadProgressText] = useState('')\n  const [loading, setLoading] = useState(false)\n\n  const singleUpload = useCallback(async () => {\n    setUploadProgressText('')\n    setLoading(true)\n    if (typeof onError === 'function') {\n      onError('')\n    }\n\n    try {\n      const files = [...fileInputRef.current.files]\n        .filter(file => file.type.startsWith('image/') && file.size < 5000000) // 5000000 bytes = 5MB\n      \n      if (files.length > 0) {\n        const thisFile = files[0]\n\n        let new_file = thisFile\n        if (thisFile.type.startsWith('image/')) {\n          new_file = await resize(thisFile)\n        }\n\n        const formData = new FormData()\n        const operations = {\n          query: `\n            mutation($file: Upload!) {\n              upload(file: $file)\n            }\n          `,\n          variables: {\n            file: null\n          }\n        }\n        formData.append('operations', JSON.stringify(operations))\n\n        const map = `{\"0\": [\"variables.file\"]}`\n        formData.append('map', map)\n        formData.append('0', new_file)\n\n\n\n\n\n        // 1. Create a new XMLHttpRequest object\n        let xhr = new XMLHttpRequest()\n        xhr.withCredentials = true\n\n        // 2. Configure it: GET-request for the URL /article/.../load\n        xhr.open('POST', window.graphql_uri, true)\n        // xhr.setRequestHeader('Content-Type', 'multipart/form-data')\n\n        // 4. This will be called after the response is received\n        xhr.onload = function () {\n          setLoading(false)\n          if (xhr.status !== 200) { // analyze HTTP status of the response\n            if (typeof onError === 'function') {\n              onError(`Error ${xhr.status}: ${xhr.statusText}`) // e.g. 404: Not Found\n            }\n          } else {\n            let data = null\n            try {\n              data = JSON.parse(xhr.response) || null\n            } catch (e) {\n              if (typeof onError === 'function') {\n                onError(e.message)\n              }\n            }\n\n            if (typeof data === 'object' && data !== null) {\n              if (data.hasOwnProperty('errors')) {\n                if (typeof onError === 'function') {\n                  onError(data.errors)\n                }\n              } else if (typeof data.data === 'object' && typeof data.data.upload === 'string') {\n                onChange(data.data.upload)\n                setLoading(false)\n              }\n            } else {\n              if (typeof onError === 'function') {\n                onError('Error: Invalid response')\n              }\n            }\n          }\n        }\n        xhr.upload.onprogress = function (event) {\n          if (event.lengthComputable) {\n            const percentComplete = parseInt((event.loaded / event.total) * 100)\n            setUploadProgressText(`${percentComplete}% (${event.loaded} of ${event.total} bytes)`)\n          } else {\n            setUploadProgressText(`${event.loaded} bytes`) // no Content-Length\n          }\n        }\n        xhr.onerror = function () {\n          setLoading(false)\n          if (typeof onError === 'function') {\n            onError('Request failed')\n          }\n        }\n\n\n        // 3. Send the request over the network\n        xhr.send(formData)\n\n\n        \n        // fetch(window.graphql_uri, {\n        //   body: formData,\n        //   method: 'post',\n        //   credentials: 'include',\n        //   allowHTTP1ForStreamingUpload: true,\n        // })\n        //   .then(response => response.json())\n        //   .then(data => {\n        //     console.log('data', data)\n        //     if (data.errors) {\n        //       throw new Error(data.errors)\n        //     } else if (data && data.data && data.data.upload) {\n        //       onChange(data.data.upload)\n        //       setLoading(false)\n        //     }\n        //   })\n        //   .catch(error => {\n        //     console.log('error', error)\n        //     setLoading(false)\n        //     if (typeof onError === 'function') {\n        //       onError(String(error))\n        //     }\n        //   })\n\n     \n      \n      \n      } else {\n        console.error('no file')\n        setLoading(false)\n        if (typeof onError === 'function') {\n          onError('no file')\n        }\n      }\n    } catch (error) {\n      console.error(error)\n      if (typeof onError === 'function') {\n        onError(String(error.message))\n      }\n    }\n  }, [onChange, onError, setUploadProgressText])\n\n  return (<div className={classes.root} style={style}>\n    <p className={classes.loadingText} style={{\n      display: loading === false ? 'none' : 'flex'\n    }}>\n      Uploading {uploadProgressText}\n    </p>\n\n    <div className={classes.inputWrapper} style={{\n      display: loading === true ? 'none' : 'flex'\n    }}>\n      <label>\n        <input type=\"file\" ref={fileInputRef} accept=\"image/png, image/jpeg\" />\n      </label>\n      <button className=\"default\" onClick={singleUpload}>Upload</button>\n    </div>\n  </div>)\n}\n\nexport default StorageFileInput\n","import { useState, useEffect, useCallback } from 'react'\n\nimport EmojiPicker from 'emoji-picker-react'\n\nimport Popover from '../Popover.js'\n\nimport { Paper } from '@mui/material'\n\nimport { Localized, withLocalization } from '../../fluent/Localized.js'\n\nimport FancyInput from './FancyInput.js'\nimport UrlInput from './UrlInput.js'\nimport StorageFileInput from './StorageFileInput.js'\nimport MultiButton from '../MultiButton.js'\n\nimport useLoadBlocks from '../../hooks/useLoadBlocks.js'\n\nconst isAbsoluteUrlRegexp = new RegExp('^(?:[a-z]+:)?//', 'i')\n\nfunction ImagePicker({ getString, trigger, types = ['url', 'emoji', 'file'], urlSuggestions = [], imageValue, onChange }) {\n\n  const [type, setType] = useState(null)\n  const [url, setUrl] = useState(null)\n  const [emoji, setEmoji] = useState(null)\n  const [fileId, setFileId] = useState(null)\n\n  const [existingImages, setExistingImages] = useState([])\n\n  const handleEmojiChange = useCallback((event, emojiObject) => {\n    const newEmoji = emojiObject.emoji || null\n    setEmoji(newEmoji)\n    onChange({ type, url, emoji: newEmoji, fileId })\n  }, [onChange, type, url, fileId])\n\n  const handleTypeChange = useCallback(newType => {\n    setType(newType)\n    onChange({ type: newType, url, emoji, fileId })\n  }, [onChange, url, emoji, fileId])\n\n  const handleUrlChange = useCallback(newUrl => {\n    setUrl(newUrl)\n    onChange({ type, url: newUrl, emoji, fileId })\n  }, [onChange, type, emoji, fileId])\n\n  const handleFileChange = useCallback(newFileId => {\n    setFileId(newFileId)\n    onChange({ type, url, emoji, fileId: newFileId })\n  }, [onChange, type, url, emoji])\n\n  const loadBlocks = useLoadBlocks()\n  useEffect(() => {\n    if (type === 'file') {\n      loadBlocks({ types: ['file'], archived: false })\n        .then(async loadedBlocks => {\n          setExistingImages(loadedBlocks.map(block => ({\n            _id: block._id,\n            text: block?.properties?.text || undefined,\n          })))\n        })\n        .catch(error => console.error(error))\n    }\n  }, [type, loadBlocks, setExistingImages])\n\n  useEffect(() => {\n    if (\n      typeof imageValue === 'object'\n      && imageValue !== null\n      && !Array.isArray(imageValue)\n    ) {\n      if (imageValue.type === 'url' || imageValue.type === 'emoji' || imageValue.type === 'file') {\n        if (types.includes(imageValue.type)) {\n          setType(imageValue.type)\n        } else {\n          setType(null)\n        }\n      } else {\n        setType(null)\n      }\n\n      if (\n        typeof imageValue.url === 'string'\n        && isAbsoluteUrlRegexp.test(imageValue.url)\n      ) {\n        setUrl(imageValue.url || '')\n      } else {\n        setUrl(null)\n      }\n\n      if (\n        typeof imageValue.emoji === 'string'\n        && imageValue.emoji.length > 0\n      ) {\n        setEmoji(imageValue.emoji || '')\n      } else {\n        setEmoji(null)\n      }\n\n      if (\n        typeof imageValue.fileId === 'string'\n        && imageValue.fileId.length > 0\n      ) {\n        setFileId(imageValue.fileId || '')\n      } else {\n        setFileId(null)\n      }\n    }\n  }, [imageValue, types, setType, setUrl, setEmoji, setFileId])\n\n  return <Popover trigger={trigger}>\n    {({closePopover, ...popoverProps}) => (\n      <Paper\n        {...popoverProps}\n        sx={{\n          maxWidth: 'calc(calc(100vw - 32px) - var(--basis_x8))',\n          maxHeight: 'calc(calc(100vh - 32px) - var(--basis_x8))',\n          overflow: 'auto',\n          padding: 'var(--basis_x4)',\n          background: 'var(--background-contrast)',\n          color: 'var(--on-background)',\n        }}\n        elevation={8}\n      >\n        {/* <h3 style={{ marginTop: '0' }}><Localized id=\"path_editor_icon_label\" /></h3> */}\n\n        <div>\n          <button\n            className={type !== 'emoji' && type !== 'url' && type !== 'file' ? 'default' : 'text'}\n            onClick={() => handleTypeChange(null)}\n          >\n            No Image\n          </button>\n          <button\n            style={{ display: types.includes('emoji') ? 'inline-block' : 'none' }}\n            className={type === 'emoji' ? 'default' : 'text'}\n            onClick={() => handleTypeChange('emoji')}\n          >\n            Emoji\n          </button>\n          <button\n            style={{ display: types.includes('url') ? 'inline-block' : 'none' }}\n            className={type === 'url' ? 'default' : 'text'}\n            onClick={() => handleTypeChange('url')}\n          >\n            Url\n          </button>\n          <button\n            style={{ display: types.includes('file') ? 'inline-block' : 'none' }}\n            className={type === 'file' ? 'default' : 'text'}\n            onClick={() => handleTypeChange('file')}\n          >\n            File\n          </button>\n        </div>\n\n        <div style={{ display: (type === 'url' ? 'block' : 'none') }}>\n          <hr />\n\n          <em className=\"body2\" style={{ display: 'block', marginBottom: 'var(--basis)' }}>\n            <Localized id=\"path_editor_icon_url_info\" />\n          </em>\n\n          <FancyInput>\n            {({ setError }) => (\n              <UrlInput\n                onError={setError}\n                onBlur={handleUrlChange}\n                defaultValue={url}\n                style={{\n                  marginRight: '0',\n                  marginLeft: '0',\n                  width: '100%'\n                }}\n              />\n            )}\n          </FancyInput>\n\n          {\n            urlSuggestions.length > 0\n            ? <MultiButton\n                onChange={handleUrlChange}\n                ariaLabel={getString('path_editor_coverphoto_label')}\n                defaultValue={url}\n                items={\n                  urlSuggestions\n                  .map(({ value = '', icon = '' }) => ({\n                    value,\n                    icon: <img alt=\"\" src={icon} className=\"icon image\" />\n                  }))\n                }\n              />\n            : null\n          }\n\n          <hr />\n        </div>\n\n        <div style={{ display: (type === 'emoji' ? 'block' : 'none') }}>                \n          <EmojiPicker\n            native={true}\n            onEmojiClick={handleEmojiChange}\n            searchPlaceholder=\"Search for an emoji\"\n            disableAutoFocus={true}\n            pickerStyle={{\n              boxShadow: 'none',\n              border: '0',\n              borderRadius: '4px',\n              // margin: 'var(--basis_x2) calc(-1 * var(--basis_x4))',\n              margin: 'var(--basis_x4) 0',\n              width: '330px',\n              height: '400px',\n            }}\n          />\n        </div>\n\n        <div style={{ display: (type === 'file' ? 'block' : 'none') }}>\n          <hr />\n\n          <em className=\"body2\" style={{ display: 'block', marginBottom: 'var(--basis)' }}>\n            <Localized id=\"path_editor_icon_file_info\" />\n          </em>\n\n          <div>\n\n            <FancyInput>\n              {({ setError }) => <StorageFileInput onChange={handleFileChange} onError={setError} style={{ margin: '0' }} />}\n            </FancyInput>\n\n            {\n              typeof fileId === 'string' && fileId.length > 0\n                ? <>\n                  <h4 style={{ marginTop: 'var(--basis_x2)' }}>Selected Image:</h4>\n                  <img src={`${window.domains.storage}download_file/?f=${window.imageFormat || 'jpg'}&w=40&h=40&id=${encodeURIComponent(fileId)}`} alt=\"Icon preview.\" width=\"40\" style={{ marginTop: 'var(--basis)' }} />\n                </>\n                : null\n            }\n\n            {\n              Array.isArray(existingImages) && existingImages.length > 0\n              ? <div style={{ width: '600px', maxWidth: '100%' }}>\n                  <h4 style={{ marginTop: 'var(--basis_x2)' }}>Already uploaded images:</h4>\n                  {\n                    existingImages.map(({ _id, text }) => (\n                      <img\n                        key={_id}\n                        onClick={() => handleFileChange(_id)}\n                        src={`${window.domains.storage}download_file/?f=${window.imageFormat || 'jpg'}&w=40&h=40&id=${encodeURIComponent(_id)}`}\n                        alt={text}\n                        title={text}\n                        width=\"40\"\n                        style={{\n                          margin: 'var(--basis_x2)',\n                          cursor: 'pointer',\n                          maxHeight: '80px',\n                        }}\n                      />\n                    ))\n                  }\n                </div>\n              : null\n            }\n\n          </div>\n\n          <hr />\n        </div>\n\n        {\n          type !== 'emoji' && type !== 'url' && type !== 'file'\n          ? <hr />\n          : null\n        }\n\n        <button className=\"text\" onClick={closePopover} style={{ margin: 0 }}>\n          Close\n        </button>\n      </Paper>\n    )}\n  </Popover>\n}\n\nexport default withLocalization(ImagePicker)\n","export default __webpack_public_path__ + \"static/media/20200912_Plakatschlange_Koeln_Matteo Sant_Unione_011.3f9289d0.png\";","export default __webpack_public_path__ + \"static/media/Aktion.89c1bcdf.png\";","import { useState, useEffect } from 'react'\n\nimport classes from './CoverphotoPicker.module.css'\n\nimport {\n  RectangleSharp as CoverphotoIcon,\n} from '@mui/icons-material'\n\nimport { withLocalization } from '../../fluent/Localized.js'\n\nimport ImagePicker from './ImagePicker.js'\n\nimport plakatschlange_thumb from '../../images/coverphotos/thumbs/20200912_Plakatschlange_Koeln_Matteo Sant_Unione_011.png'\nimport aktion_thumb from '../../images/coverphotos/thumbs/Aktion.png'\nimport volt_bonn_thumb from '../../images/coverphotos/thumbs/tYADz4UyUAAcV5WlmWLlkXD9LG8W02U9LbQd8rxzQ2bt99lxwK.png'\nimport welcome_to_volt_thumb from '../../images/coverphotos/thumbs/Welcome-to-Volt.png'\nimport portugal_thumb from '../../images/coverphotos/thumbs/portugal.jpg'\n\nconst urlSuggestions = [\n  {\n    value: 'https://assets.volteuropa.org/styles/scale_2880x/public/inline-images/tYADz4UyUAAcV5WlmWLlkXD9LG8W02U9LbQd8rxzQ2bt99lxwK.jpg',\n    icon: volt_bonn_thumb,\n  },\n  {\n    value: 'https://assets.volteuropa.org/styles/scale_1920x/public/2020-11/Welcome-to-Volt.jpg',\n    icon: welcome_to_volt_thumb,\n  },\n  {\n    value: 'https://assets.volteuropa.org/styles/scale_1920x/public/2021-07/20200912_Plakatschlange_Ko%CC%88ln_Matteo%20Sant_Unione_011.jpeg',\n    icon: plakatschlange_thumb,\n  },\n  {\n    value: 'https://assets.volteuropa.org/2021-11/portugal.jpg',\n    icon: portugal_thumb,\n  },\n  {\n    value: 'https://assets.volteuropa.org/styles/scale_1920x/public/2021-05/Aktion.jpeg',\n    icon: aktion_thumb,\n  },\n  // 'https://www.volteuropa.org/stripes/hero-desktop-green.jpg',\n  // 'https://www.volteuropa.org/stripes/hero-desktop-red.jpg',\n  // 'https://www.volteuropa.org/stripes/hero-desktop-blue.jpg',\n  // 'https://www.volteuropa.org/stripes/hero-desktop-yellow.jpg',\n  // 'https://assets.volteuropa.org/styles/scale_1920x/public/2021-05/Colours-Background-Big.jpeg',\n  // 'https://www.volteuropa.org/stripes/intermediate-green.jpg',\n  // 'https://www.volteuropa.org/stripes/intermediate-red.jpg',\n  // 'https://www.volteuropa.org/stripes/intermediate-blue.jpg',\n  // 'https://www.volteuropa.org/stripes/intermediate-yellow.jpg',\n  // 'https://www.volteuropa.org/og-default.png',\n  // 'https://www.volteuropa.org/hero-default.jpg',\n]\n\nconst isAbsoluteUrlRegexp = new RegExp('^(?:[a-z]+:)?//', 'i')\n\nfunction CoverphotoPicker({ coverphotoValue, iconValue, onChange, className, style }) {\n\n  const [coverphotoIsSet, setCoverphotoIsSet] = useState(false)\n\n  const [type, setType] = useState(null)\n  const [url, setUrl] = useState(null)\n  const [fileId, setFileId] = useState(null)\n\n  useEffect(() => {\n    if (\n      typeof coverphotoValue === 'object'\n      && coverphotoValue !== null\n      && !Array.isArray(coverphotoValue)\n    ) {\n      let newCoverphotoIsSet = false\n\n      if (coverphotoValue.type === 'url' || coverphotoValue.type === 'file') {\n        setType(coverphotoValue.type)\n      } else {\n        setType(null)\n      }\n\n      if (\n        typeof coverphotoValue.url === 'string'\n        && isAbsoluteUrlRegexp.test(coverphotoValue.url)\n      ) {\n        setUrl(coverphotoValue.url || '')\n\n        if (coverphotoValue.type === 'url') {\n          newCoverphotoIsSet = true\n        }\n      } else {\n        setUrl(null)\n      }\n\n      if (\n        typeof coverphotoValue.fileId === 'string'\n        && coverphotoValue.fileId.length > 0\n      ) {\n        setFileId(coverphotoValue.fileId || '')\n\n        if (coverphotoValue.type === 'file') {\n          newCoverphotoIsSet = true\n        }\n      } else {\n        setFileId(null)\n      }\n\n      setCoverphotoIsSet(newCoverphotoIsSet)\n    }\n  }, [coverphotoValue, setType, setUrl, setFileId, setCoverphotoIsSet])\n\n  let iconIsSet = false\n\n  if (\n    typeof iconValue === 'object'\n    && iconValue !== null\n    && !Array.isArray(iconValue)\n  ) {\n    if (\n      (\n        iconValue.type === 'url'\n        && typeof iconValue.url === 'string'\n        && isAbsoluteUrlRegexp.test(iconValue.url)\n      )\n      || (\n        iconValue.type === 'emoji'\n        && typeof iconValue.emoji === 'string'\n        && iconValue.emoji.length > 0\n      )\n      || (\n        iconValue.type === 'file'\n        && typeof iconValue.fileId === 'string'\n        && iconValue.fileId.length > 0\n      )\n    ) {\n      iconIsSet = true\n    }\n  }\n\n  let imageUrl = ''\n  if (type === 'url' && coverphotoIsSet && !!url) {\n    imageUrl = `url(${window.domains.storage}download_url?f=${window.imageFormat || 'jpg'}&w=1400&h=400&url=${encodeURIComponent(url)})`\n  } else if (type === 'file' && coverphotoIsSet && !!fileId) {\n    imageUrl = `url(${window.domains.storage}download_file/?f=${window.imageFormat || 'jpg'}&w=1400&h=400&id=${encodeURIComponent(fileId)})`\n  }\n\n  return <div\n    className={`\n      ${classes.root}\n      ${iconIsSet ? classes.iconIsSet : classes.iconIsNotSet}\n      ${coverphotoIsSet ? classes.coverphotoIsSet : classes.coverphotoIsNotSet}\n      ${className || ''}\n    `}\n    style={style}\n  >\n    <ImagePicker\n      imageValue={coverphotoValue}\n      onChange={onChange}\n      types={['url', 'file']}\n      urlSuggestions={urlSuggestions}\n      trigger={(triggerProps) => (\n        <div\n          className={classes.coverphoto}\n          style={{\n            backgroundImage: imageUrl,\n          }}\n        >\n          <div className={classes.button_wrapper}>\n            <button {...triggerProps} className={`hasIcon ${coverphotoIsSet ? 'default' : 'text'} ${classes.changeCoverphotoButton}`}>\n              <CoverphotoIcon className=\"icon\" />\n              <span style={{ marginInlineStart: 'var(--basis_x2)', verticalAlign: 'middle'}}>Set Coverphoto</span>\n            </button>\n          </div>\n        </div>\n      )}\n    />\n  </div>\n}\n\nexport default withLocalization(CoverphotoPicker)\n\n\n\n/*\n\nimport classes from './CoverphotoPicker.module.css'\n\n// import { getImageUrl } from '../../functions.js'\n\nimport Popover from '../Popover.js'\n\nimport { Paper } from '@mui/material'\nimport {\n  RectangleSharp as CoverphotoIcon,\n} from '@mui/icons-material'\n\nimport { Localized, withLocalization } from '../../fluent/Localized.js'\n\nimport MultiButton from '../MultiButton.js'\nimport FancyInput from './FancyInput.js'\nimport UrlInput from './UrlInput.js'\n\nimport plakatschlange_thumb from '../../images/coverphotos/thumbs/20200912_Plakatschlange_Koeln_Matteo Sant_Unione_011.png'\nimport aktion_thumb from '../../images/coverphotos/thumbs/Aktion.png'\nimport volt_bonn_thumb from '../../images/coverphotos/thumbs/tYADz4UyUAAcV5WlmWLlkXD9LG8W02U9LbQd8rxzQ2bt99lxwK.png'\nimport welcome_to_volt_thumb from '../../images/coverphotos/thumbs/Welcome-to-Volt.png'\nimport portugal_thumb from '../../images/coverphotos/thumbs/portugal.jpg'\n\n\nfunction CoverphotoPicker({ getString, coverphotoValue, iconValue, onChange, className = '', style = {} }) {\n  \n  const onUrlChange = newUrl => {\n    onChange({\n      type: 'url',\n      url: newUrl,\n    })\n  }\n\n  const isAbsoluteUrlRegexp = new RegExp('^(?:[a-z]+:)?//', 'i')\n\n  // if (\n  //   typeof coverphotoValue === 'object'\n  //   && coverphotoValue !== null\n  //   && !Array.isArray(coverphotoValue)\n  // ) {\n  //   if (coverphotoValue.type === 'url') {\n  //     return coverphotoValue.url || ''\n  //   }\n  // }\n\n  let coverphotoValueUrl = ''\n  let coverphotoIsSet = false\n  let iconIsSet = false\n\n  if (\n    typeof coverphotoValue === 'object'\n    && coverphotoValue !== null\n    && !Array.isArray(coverphotoValue)\n  ) {\n    if (\n      coverphotoValue.type === 'url'\n      && typeof coverphotoValue.url === 'string'\n      && isAbsoluteUrlRegexp.test(coverphotoValue.url)\n    ) {\n      coverphotoIsSet = true\n      coverphotoValueUrl = coverphotoValue.url || ''\n    }\n  }\n\n  if (\n    typeof iconValue === 'object'\n    && iconValue !== null\n    && !Array.isArray(iconValue)\n  ) {\n    if (\n      (\n        iconValue.type === 'url'\n        && typeof iconValue.url === 'string'\n        && isAbsoluteUrlRegexp.test(iconValue.url)\n      )\n      || (\n        iconValue.type === 'emoji'\n        && typeof iconValue.emoji === 'string'\n        && iconValue.emoji.length > 0\n      )\n      || (\n        iconValue.type === 'file'\n        && typeof iconValue.fileId === 'string'\n        && iconValue.fileId.length > 0\n      )\n    ) {\n      iconIsSet = true\n    }\n  }\n\n  return <div\n    className={`\n      ${classes.root}\n      ${coverphotoIsSet ? classes.coverphotoIsSet : classes.coverphotoIsNotSet}\n      ${iconIsSet ? classes.iconIsSet : classes.iconIsNotSet}\n      ${className}\n    `}\n    style={style}\n  >\n    <Popover\n      trigger={(triggerProps) => (\n        <div\n          className={classes.coverphoto}\n          style={{\n            backgroundImage: coverphotoIsSet ? `url(${window.domains.storage}download_url?f=jpg&w=1400&h=400&url=${encodeURIComponent(coverphotoValue.url)})` : '',\n          }}\n        >\n          <div className={classes.button_wrapper}>\n            <button {...triggerProps} className={`hasIcon ${coverphotoIsSet ? 'default' : 'text'} ${classes.changeCoverphotoButton}`}>\n              <CoverphotoIcon className=\"icon\" />\n              <span style={{ marginInlineStart: 'var(--basis_x2)', verticalAlign: 'middle'}}>Set Coverphoto</span>\n            </button>\n          </div>\n        </div>\n      )}\n    >\n      {({closePopover, ...popoverProps}) => (\n        <Paper\n          {...popoverProps}\n          sx={{\n            maxWidth: 'calc(calc(100vw - 32px) - var(--basis_x8))',\n            maxHeight: 'calc(calc(100vh - 32px) - var(--basis_x8))',\n            overflow: 'auto',\n            padding: 'var(--basis_x4)',\n            background: 'var(--background-contrast)',\n            color: 'var(--on-background)',\n          }}\n          elevation={8}\n        >\n          <h3 style={{ marginTop: '0' }}><Localized id=\"path_editor_coverphoto_label\" /></h3>\n\n          <em className=\"body2\" style={{ display: 'block', marginBottom: 'var(--basis)' }}>\n            <Localized id=\"path_editor_coverphoto_info\" />\n          </em>\n\n          <FancyInput>\n            {({ setError }) => (\n              <UrlInput\n                onError={setError}\n                onChange={onUrlChange}\n                defaultValue={coverphotoValueUrl}\n                style={{\n                  marginRight: '0',\n                  marginLeft: '0',\n                  width: '100%'\n                }}\n              />\n            )}\n          </FancyInput>\n\n          <MultiButton\n            onChange={onUrlChange}\n            ariaLabel={getString('path_editor_coverphoto_label')}\n            defaultValue={coverphotoValueUrl}\n            items={[\n              {\n                value: '',\n                title: getString('path_editor_no_coverphoto'),\n              },\n              ...[\n                {\n                  value: 'https://assets.volteuropa.org/styles/scale_2880x/public/inline-images/tYADz4UyUAAcV5WlmWLlkXD9LG8W02U9LbQd8rxzQ2bt99lxwK.jpg',\n                  icon: volt_bonn_thumb,\n                },\n                {\n                  value: 'https://assets.volteuropa.org/styles/scale_1920x/public/2020-11/Welcome-to-Volt.jpg',\n                  icon: welcome_to_volt_thumb,\n                },\n                {\n                  value: 'https://assets.volteuropa.org/styles/scale_1920x/public/2021-07/20200912_Plakatschlange_Ko%CC%88ln_Matteo%20Sant_Unione_011.jpeg',\n                  icon: plakatschlange_thumb,\n                },\n                {\n                  value: 'https://assets.volteuropa.org/2021-11/portugal.jpg',\n                  icon: portugal_thumb,\n                },\n                {\n                  value: 'https://assets.volteuropa.org/styles/scale_1920x/public/2021-05/Aktion.jpeg',\n                  icon: aktion_thumb,\n                },\n                // 'https://www.volteuropa.org/stripes/hero-desktop-green.jpg',\n                // 'https://www.volteuropa.org/stripes/hero-desktop-red.jpg',\n                // 'https://www.volteuropa.org/stripes/hero-desktop-blue.jpg',\n                // 'https://www.volteuropa.org/stripes/hero-desktop-yellow.jpg',\n                // 'https://assets.volteuropa.org/styles/scale_1920x/public/2021-05/Colours-Background-Big.jpeg',\n                // 'https://www.volteuropa.org/stripes/intermediate-green.jpg',\n                // 'https://www.volteuropa.org/stripes/intermediate-red.jpg',\n                // 'https://www.volteuropa.org/stripes/intermediate-blue.jpg',\n                // 'https://www.volteuropa.org/stripes/intermediate-yellow.jpg',\n                // 'https://www.volteuropa.org/og-default.png',\n                // 'https://www.volteuropa.org/hero-default.jpg',\n              ]\n              .map(({value = '', icon = ''}) => ({\n                value,\n                icon: <img alt=\"\" src={icon} className=\"icon image\" />\n              }))\n            ]}\n          />\n\n          <hr />\n\n          <button className=\"text\" onClick={closePopover} style={{ margin: 0 }}>\n            Close\n          </button>\n        </Paper>\n      )}\n    </Popover>\n  </div>\n}\n\nexport default withLocalization(CoverphotoPicker)\n*/\n","export default __webpack_public_path__ + \"static/media/tYADz4UyUAAcV5WlmWLlkXD9LG8W02U9LbQd8rxzQ2bt99lxwK.6824f6ef.png\";","export default __webpack_public_path__ + \"static/media/Welcome-to-Volt.39e04eca.png\";","export default __webpack_public_path__ + \"static/media/portugal.682fc2e3.jpg\";","import { useState, useEffect } from 'react'\n\nimport Twemoji from '../Twemoji.js'\n\nimport classes from './IconPicker.module.css'\n\nimport {\n  CircleSharp as IconIcon,\n} from '@mui/icons-material'\n\nimport { withLocalization } from '../../fluent/Localized.js'\n\nimport ImagePicker from './ImagePicker.js'\n\nconst isAbsoluteUrlRegexp = new RegExp('^(?:[a-z]+:)?//', 'i')\n\nfunction IconPicker({ coverphotoValue, iconValue, onChange, className, style }) {\n\n  const [iconIsSet, setIconIsSet] = useState(false)\n\n  const [type, setType] = useState(null)\n  const [url, setUrl] = useState(null)\n  const [emoji, setEmoji] = useState(null)\n  const [fileId, setFileId] = useState(null)\n\n  useEffect(() => {\n    if (\n      typeof iconValue === 'object'\n      && iconValue !== null\n      && !Array.isArray(iconValue)\n    ) {\n      let newIconIsSet = false\n\n      if (iconValue.type === 'url' || iconValue.type === 'emoji' || iconValue.type === 'file') {\n        setType(iconValue.type)\n      } else {\n        setType(null)\n      }\n\n      if (\n        typeof iconValue.url === 'string'\n        && isAbsoluteUrlRegexp.test(iconValue.url)\n      ) {\n        setUrl(iconValue.url || '')\n\n        if (iconValue.type === 'url') {\n          newIconIsSet = true\n        }\n      } else {\n        setUrl(null)\n      }\n\n      if (\n        typeof iconValue.emoji === 'string'\n        && iconValue.emoji.length > 0\n      ) {\n        setEmoji(iconValue.emoji || '')\n\n        if (iconValue.type === 'emoji') {\n          newIconIsSet = true\n        }\n      } else {\n        setEmoji(null)\n      }\n\n      if (\n        typeof iconValue.fileId === 'string'\n        && iconValue.fileId.length > 0\n      ) {\n        setFileId(iconValue.fileId || '')\n\n        if (iconValue.type === 'file') {\n          newIconIsSet = true\n        }\n      } else {\n        setFileId(null)\n      }\n\n      setIconIsSet(newIconIsSet)\n    }\n  }, [iconValue, setType, setUrl, setEmoji, setFileId, setIconIsSet])\n\n  let coverphotoIsSet = false\n\n  if (\n    typeof coverphotoValue === 'object'\n    && coverphotoValue !== null\n    && !Array.isArray(coverphotoValue)\n  ) {\n    if (\n      coverphotoValue.type === 'url'\n      && typeof coverphotoValue.url === 'string'\n      && isAbsoluteUrlRegexp.test(coverphotoValue.url)\n    ) {\n      coverphotoIsSet = true\n    } else if (\n      coverphotoValue.type === 'file'\n      && typeof coverphotoValue.fileId === 'string'\n      && coverphotoValue.fileId.lengh > 0\n    ) {\n      coverphotoIsSet = true\n    }\n  }\n\n  return <div\n    className={`\n      ${classes.root}\n      ${iconIsSet ? classes.iconIsSet : classes.iconIsNotSet}\n      ${coverphotoIsSet ? classes.coverphotoIsSet : classes.coverphotoIsNotSet}\n      ${classes[`image_type_${type}`] || ''}\n      ${className || ''}\n    `}\n    style={style}\n  >\n    <ImagePicker\n      imageValue={iconValue}\n      onChange={onChange}\n      types={['url', 'emoji', 'file']}\n      trigger={(triggerProps) => (\n        <div className={classes.iconWrapper}>\n          {\n            type === 'url'\n              ? <div\n                className={classes.icon}\n                style={{\n                  backgroundImage: iconIsSet && !!url ? `url(${window.domains.storage}download_url?f=${window.imageFormat || 'jpg'}&w=400&h=400&url=${encodeURIComponent(url)})` : '',\n                }}\n              ></div>\n              : null\n          }\n          {\n            type === 'emoji'\n              ? <div\n                className={classes.icon}\n              >\n                <Twemoji emoji={emoji} className={classes.emojiWrapper} />\n              </div>\n              : null\n          }\n          {\n            type === 'file'\n              ? <div\n                className={classes.icon}\n                style={{\n                  backgroundImage: iconIsSet && !!fileId ? `url(${window.domains.storage}download_file/?f=${window.imageFormat || 'jpg'}&w=400&h=400&id=${encodeURIComponent(fileId)})` : '',\n                }}\n              ></div>\n              : null\n          }\n\n          <button {...triggerProps} className={`hasIcon ${iconIsSet ? 'default' : 'text'} ${classes.changeIconButton}`}>\n            <IconIcon className=\"icon\" />\n            <span style={{ marginInlineStart: 'var(--basis_x2)', verticalAlign: 'middle' }}>Set Icon</span>\n          </button>\n        </div>\n      )}\n    />\n  </div>\n}\n\nexport default withLocalization(IconPicker)\n","import { useRef, useCallback, useState, useEffect } from 'react'\n\nimport HtmlInput from './HtmlInput.js'\nimport useCheckSlug from '../../hooks/useCheckSlug.js'\n\nfunction SlugInput({\n  defaultValue = '',\n  onChange,\n  onBlur,\n  onSubmit,\n  onError,\n  allowExisting = false,\n  placeholder = 'de-bonn',\n  ...props\n}) {\n  const mountedRef = useRef(false)\n  useEffect(() => {\n    mountedRef.current = true\n    return () => {\n      mountedRef.current = false\n    }\n  }, [])\n\n  const checkSlug = useCheckSlug()\n\n  const [text, setText] = useState('')\n\n  useEffect(() => {\n    if (mountedRef.current) {\n      setText(defaultValue)\n    }\n  }, [setText, defaultValue])\n\n  const handleTextChange = useCallback(async newText => {\n    newText = newText.toLowerCase()\n    setText(newText)\n\n    let isSubmittable = true\n    let error = ''\n    if (newText !== '') {\n      const {\n        isOkay,\n        errors\n      } = (await checkSlug(newText)) || {}\n      \n      isSubmittable = isOkay\n      error = errors.join('\\n')\n    }\n\n    if (isSubmittable && onChange) {\n      onChange(newText)\n    }\n\n    if (onError) {\n      onError(error)\n    }\n  }, [\n    setText,\n    checkSlug,\n    onChange,\n    onError,\n  ])\n\n  const handleBlur = useCallback(() => {\n    if (onBlur) {\n      onBlur(text)\n    }\n  }, [onBlur, text])\n\n  return <HtmlInput\n    onChange={handleTextChange}\n    onBlur={handleBlur}\n    defaultValue={defaultValue}\n    placeholder={placeholder}\n    linebreaks={false}\n    {...props}\n  />\n}\n\nexport default SlugInput\n","import { useCallback } from 'react'\n\nimport { useApolloClient } from '@apollo/client'\nimport { checkSlug_Query } from '../graphql/queries'\n\nexport default function useCheckSlug() {\n  const apollo_client = useApolloClient()\n\n  const handleCheckSlug = useCallback((slug = '') => {\n    return new Promise(resolve => {\n      apollo_client.query({\n        query: checkSlug_Query,\n        variables: {\n          slug,\n        },\n      })\n        .then(async ({ data }) => {\n          if (data.hasOwnProperty('checkSlug')) {\n            resolve(data.checkSlug)\n          } else {\n            resolve(null)\n          }\n        })\n        .catch(async error => {\n          console.error('error', error)\n          resolve(null)\n        })\n    })\n  }, [apollo_client])\n\n  return handleCheckSlug\n}\n","import { useState, useCallback, useEffect } from 'react'\n\n// import { v4 as uuidv4 } from 'uuid'\n\nimport classes from './PropertiesEditor.module.css'\n\nimport { Localized, withLocalization } from '../../fluent/Localized.js'\nimport HtmlInput from './HtmlInput.js'\nimport FancyInput from './FancyInput.js'\nimport CoverphotoPicker from './CoverphotoPicker.js'\nimport IconPicker from './IconPicker.js'\nimport SlugInput from './SlugInput.js'\nimport UrlInput from './UrlInput.js'\n\n// function stripTmpIds(array){\n//   return [...array].map(obj => {\n//     const obj_new = { ...obj }\n//     delete obj_new._id\n//     return obj_new\n//   })\n// }\n\n// function addTmpIds(array) {\n//   return [...(array || [])].map(obj => {\n//     if (!obj.tmp_id) {\n//       const obj_new = { ...obj }\n//       obj_new.tmp_id = uuidv4()\n//       return obj_new\n//     }\n//\n//     return obj\n//   })\n// }\n\nfunction PropertiesEditor({ getString, type, defaultProperties = {}, onChange }) {\n  const [properties, setProperties] = useState({})\n\n  // const [coverphoto, setCoverphoto] = useState('')\n  // const [imprint, setImprint] = useState('')\n  // const [privacy_policy, setPrivacyPolicy] = useState('')\n  // const [link, setLink] = useState('')\n\n  // let [voltTeams, setVoltTeams] = useState([])\n  // voltTeams = voltTeams.map(({ id, name }) => ({ value: id, label: name }))\n\n  // const [voltTeamInfos, setVoltTeamInfos] = useState({\n  //   id: null,\n  //   name: ''\n  // })\n  // const setVoltTeamInfosFromSelect = useCallback((data) => {\n  //   setVoltTeamInfos({\n  //     id: data.value,\n  //     name: data.label,\n  //   })\n  // }, [setVoltTeamInfos])\n\n  const updateProperty = useCallback((propertyKey, newPropertyValue, silent = false) => {\n    const propertyTypes = {\n      text: 'string',\n      coverphoto: 'object',\n      icon: 'object',\n      imprint: 'string',\n      privacy_policy: 'string',\n      tags: 'string',\n      checked: 'boolean',\n      slug: 'string',\n      url: 'string',\n      pronouns: 'string',\n    }\n\n    const newProperties = { ...properties }\n\n    if (propertyTypes.hasOwnProperty(propertyKey)) {\n      switch (propertyTypes[propertyKey]) {\n        case 'array':\n          if (newPropertyValue.length > 0) {\n            newProperties[propertyKey] = newPropertyValue\n          } else if (newProperties.hasOwnProperty(propertyKey)) {\n            newProperties[propertyKey] = null\n          }\n        break\n        case 'string':\n          if (newPropertyValue !== '') {\n            newProperties[propertyKey] = newPropertyValue\n          } else if (newProperties.hasOwnProperty(propertyKey)) {\n            newProperties[propertyKey] = null\n          }\n        break\n        case 'boolean':\n          if (newPropertyValue === true) {\n            newProperties[propertyKey] = true\n          } else if (newProperties.hasOwnProperty(propertyKey)) {\n            newProperties[propertyKey] = null\n          }\n        break\n        case 'object':\n          if (\n            typeof newPropertyValue === 'object'\n            && newPropertyValue !== null\n            && Object.keys(newPropertyValue).length > 0\n          ) {\n            newProperties[propertyKey] = newPropertyValue\n          } else if (newProperties.hasOwnProperty(propertyKey)) {\n            newProperties[propertyKey] = null\n          }\n        break\n        default:\n          newProperties[propertyKey] = newPropertyValue\n      }\n    }\n\n    if (JSON.stringify(newProperties) !== JSON.stringify(properties)) {\n      setProperties(newProperties)\n      if (silent === false && onChange) {\n        onChange(newProperties)\n      }\n    }\n  }, [\n    properties,\n    setProperties,\n    onChange,\n  ])\n\n  const publishProperties = useCallback(() => {\n    if (onChange) {\n      onChange(properties)\n    }\n  }, [properties, onChange])\n\n  useEffect(() => {\n    setProperties({\n      ...defaultProperties,\n      text: defaultProperties?.text || '',\n    })\n  }, [\n    defaultProperties,\n    setProperties,\n  ])\n\n\n  // useEffect(() => {\n  //   fetch(`${window.domains.backend}teams_simple.json`, {\n  //     mode: 'cors',\n  //     credentials: 'include',\n  //   })\n  //     .then(response => response.json())\n  //     .then(data => {\n  //       if (typeof data.error === 'string') {\n  //         setVoltTeams([])\n  //       } else {\n  //         setVoltTeams(data)\n  //       }\n  //     })\n  //     .catch(error => {\n  //       console.error(error)\n  //       setVoltTeams([])\n  //     })\n  // }, [ setVoltTeams ])\n\n  let propertiesFrameContent = null\n  // if (type === 'page') {\n  //   propertiesFrameContent = <>\n  //     <div className={classes.properties_row}>\n  //     <h3><Localized id=\"properties_editor_imprint_label\" /></h3>\n  //     <div>\n  //     <FancyInput>\n  //       {({ setError }) => (\n  //         <UrlInput\n  //           onError={setError}\n  //           onBlur={newValue => updateProperty('imprint', newValue)}\n  //           defaultValue={properties.imprint}\n  //           type=\"text\"\n  //           style={{\n  //             margin: '0',\n  //             width: '100%'\n  //           }}\n  //           // className=\"show_border_on_active\"\n  //         />\n  //       )}\n  //     </FancyInput>\n  //     </div>\n  //     </div>\n  //\n  //     <div className={classes.properties_row}>\n  //     <h3><Localized id=\"properties_editor_privacy_policy_label\" /></h3>\n  //     <div>\n  //     <FancyInput>\n  //       {({ setError }) => (\n  //         <UrlInput\n  //           onError={setError}\n  //           onBlur={newValue => updateProperty('privacy_policy', newValue)}\n  //           defaultValue={properties.privacy_policy}\n  //           type=\"text\"\n  //           style={{\n  //             margin: '0',\n  //             width: '100%'\n  //           }}\n  //           // className=\"show_border_on_active\"\n  //         />\n  //       )}\n  //     </FancyInput>\n  //     </div>\n  //     </div>\n  //   </>\n  // } else if (type === 'person') {\n  //   propertiesFrameContent = <>\n  //     <div className={classes.properties_row}>\n  //       <h3><Localized id=\"properties_editor_pronouns_label\" /></h3>\n  //       <HtmlInput\n  //         defaultValue={properties.pronouns}\n  //         onChange={newValue => updateProperty('pronouns', newValue, true)}\n  //         onBlur={publishProperties}\n  //         placeholder={''}\n  //         style={{\n  //           margin: '0',\n  //           width: '100%',\n  //         }}\n  //         linebreaks={false}\n  //         className={`type_text`}\n  //       />\n  //     </div>\n  //   </>\n  // } else\n  if (type === 'button' || type === 'redirect') {\n    propertiesFrameContent = <>\n      <div className={classes.properties_row}>\n        <h3><Localized id=\"properties_editor_action_url_label\" /></h3>\n        <FancyInput style={{ width: '100%' }}>\n          {({ setError }) => (\n            <UrlInput\n              onError={setError}\n              onBlur={newValue => updateProperty('url', newValue)}\n              type=\"text\"\n              defaultValue={properties.url || ''}\n              placeholder={getString('action_input_url_placeholder')}\n              style={{\n                marginRight: '0',\n                marginLeft: '0',\n                width: '100%'\n              }}\n            />\n          )}\n        </FancyInput>\n      </div>\n    </>\n  } else if (type === 'person') {\n    propertiesFrameContent = <>\n      <div className={classes.properties_row}>\n        <h3><Localized id=\"properties_editor_pronouns_label\" /></h3>\n        <HtmlInput\n          defaultValue={properties?.pronouns || ''}\n          onChange={newValue => updateProperty('pronouns', newValue, true)}\n          onBlur={publishProperties}\n\n          placeholder={getString('placeholder_pronouns')}\n          style={{\n            padding: 'var(--basis) var(--basis_x2)',\n          }}\n          linebreaks={false}\n          className={`type_p`}\n        />\n      </div>\n    </>\n  }\n\n  return <>\n    {\n      type === 'page'\n      || type === 'person'\n      || type === 'redirect'\n      ? <>\n          <CoverphotoPicker\n            coverphotoValue={properties.coverphoto}\n            iconValue={properties.icon}\n            onChange={newValue => updateProperty('coverphoto', newValue)}\n          />\n          <IconPicker\n            iconValue={properties.icon}\n            coverphotoValue={properties.coverphoto}\n            onChange={newValue => updateProperty('icon', newValue)}\n          />\n        </>\n      : null\n    }\n\n    <div className={classes.main_headline} style={{\n      paddingLeft: 'calc(8 * var(--basis))',\n    }}>\n      <HtmlInput\n        defaultValue={properties?.text || ''}\n        onChange={newValue => updateProperty('text', newValue, true)}\n        onBlur={publishProperties}\n\n        placeholder={getString('placeholder_headline_empty')}\n        style={{\n          padding: 'var(--basis) var(--basis_x2)',\n        }}\n        linebreaks={false}\n        className={`type_h1`}\n      />\n    </div>\n\n    <div\n      className={classes.propertiesFrame}\n      // style={\n      //   propertiesFrameContent === null\n      //     ? { display: 'none' }\n      //     : null\n      // }\n    >\n      <div className={classes.properties_row}>\n        <h3><Localized id=\"properties_editor_trigger_path_label\" /></h3>\n        <FancyInput\n          style={{\n            flexGrow: '1',\n          }}\n        >\n          {({ setError }) => (\n            <SlugInput\n              onError={setError}\n              placeholder={getString('trigger_input_path_placeholder')}\n              defaultValue={properties.slug || ''}\n              onBlur={newValue => updateProperty('slug', newValue)}\n              style={{\n                marginRight: '0',\n                marginLeft: '0',\n                width: '100%'\n              }}\n            // className=\"show_border_on_active\"\n            />\n          )}\n        </FancyInput>\n      </div>\n      \n      {propertiesFrameContent}\n\n      {/* <div className={classes.properties_row}>\n        <h3><Localized id=\"path_editor_tags_label\" /></h3>\n        <HtmlInput\n          onBlur={newValue => updateProperty('tags', newValue)}\n          type=\"text\"\n          placeholder={getString('path_editor_tags_placeholder')}\n          aria-label={getString('path_editor_tags_label')}\n          defaultValue={properties.tags}\n          style={{\n            marginRight: '0',\n            marginLeft: '0',\n            width: 'calc(100% - var(--basis_x2))'\n          }}\n        />\n      </div> */}\n\n      {/*\n        voltTeams && voltTeams.length > 0\n        ? <>\n          <h3><Localized id=\"path_editor_belongs_to_team_label\" /></h3>\n          <em className=\"body2\" style={{ display: 'block', marginBottom: 'var(--basis)' }}><Localized id=\"path_editor_belongs_to_team_info\" /></em>\n          <Select\n            defaultValue={{\n              value: voltTeamInfos !== null ? voltTeamInfos.id || null : null,\n              label: voltTeamInfos !== null ? voltTeamInfos.name || '' : '',\n            }}\n            defaultInputValue={voltTeamInfos !== null ? voltTeamInfos.name || '' : ''}\n            onChange={setVoltTeamInfosFromSelect}\n            ariaLabel={getString('path_editor_belongs_to_team_search_placeholder')}\n            label={getString('path_editor_belongs_to_team_search_placeholder')}\n            placeholder={getString('path_editor_belongs_to_team_search_placeholder')}\n            options={voltTeams}\n            styles={custom_react_select_styles}\n            theme={custom_react_select_theme}\n          />\n        </>\n        : null\n      */}\n    </div>\n  </>\n}\n\nexport default withLocalization(PropertiesEditor)\n","import { useCallback, useState } from 'react'\n\nimport {\n  CheckBox as CheckBoxIcon,\n  CheckBoxOutlineBlank as CheckBoxOutlineBlankIcon,\n} from '@mui/icons-material'\n\nfunction CheckboxInput({\n  defaultValue = false,\n  onChange,\n  onBlur,\n  style,\n  className,\n  disabled = false,\n}) {\n  // TODO: make ARIA compatible\n\n  const [checked, setChecked] = useState(Boolean(defaultValue))\n\n  const toggleChecked = useCallback(() => {\n    if (disabled === true) {\n      return\n    }\n\n    const newChecked = !checked\n\n    setChecked(newChecked)\n    if (onChange) {\n      onChange(newChecked)\n    }\n    if (onBlur) {\n      onBlur(newChecked)\n    }\n  }, [disabled, checked, setChecked, onChange, onBlur])\n\n  const iconProps = {\n    className: className,\n    onClick: toggleChecked,\n    style: {\n      display: 'inline-block',\n      margin: 'var(--basis)',\n      cursor: disabled === true ? 'default' : 'pointer',\n      // verticalAlign: 'middle',\n      // backgroundColor: 'red',\n      lineHeight: 0,\n      height: 'var(--prefix-icon-size)',\n      width: 'var(--prefix-icon-size)',\n      ...style,\n    }\n  }\n\n  if (checked) {\n    return <CheckBoxIcon {...iconProps} />\n  } else {\n    return <CheckBoxOutlineBlankIcon {...iconProps} />\n  }\n}\n\nexport default CheckboxInput\n","import React, { useState, useEffect, useCallback } from 'react'\n\nimport CheckboxInput from './CheckboxInput.js'\n\nimport { withLocalization } from '../../fluent/Localized.js'\nimport { getBlockColor } from '../../functions.js'\n\nimport HtmlInput from './HtmlInput.js'\n\nfunction InlineEditorBlockTextRaw({\n  getString,\n  block = {},\n  onChange,\n  onSaveBlock,\n  saveProperty,\n\n  onInputRef,\n  onGoToPrevInput,\n  onGoToNextInput,\n  onSplitText,\n  onMergeToPrevInput,\n  onMergeFromNextInput,\n\n  onAddRowAfter,\n}) {\n  const properties = block.properties || {}\n  const [text, setText] = useState('')\n\n  useEffect(() => {\n    setText(properties.text || '')\n  }, [properties.text, setText])\n\n  const publishTextChange = useCallback(() => {\n    if (onChange) {\n      onChange({\n        ...block,\n        properties: {\n          ...block.properties,\n          text,\n        },\n      })\n    }\n  }, [onChange, block, text])\n\n  let text_style_class = 'type_p'\n  if (properties.hasOwnProperty('text_style')) {\n    if (properties.text_style === 'text') {\n      text_style_class = 'type_p'\n    } else {\n      text_style_class = 'type_'+properties.text_style\n    }\n  }\n\n  const {\n    color,\n  } = getBlockColor(block)\n\n  const colorStyles = {}\n  if (color) {\n    colorStyles.color = color\n  }\n\n\n\n  const toggleChecked = useCallback(newCheckedValue => {\n    saveProperty('checked', newCheckedValue)\n  }, [saveProperty])\n\n  let {\n    text_decorations = [],\n    checked,\n  } = properties\n  if (!Array.isArray(text_decorations)) {\n    text_decorations = []\n  }\n  if (typeof checked !== 'boolean') {\n    checked = false\n  }\n\n  const prefixes = []\n\n  if (text_decorations.includes('checkbox')) {\n    const checkbox_component = <CheckboxInput\n      key='checkbox'\n      defaultValue={checked}\n      onChange={toggleChecked}\n      style={{\n        margin: 'var(--basis_x0_2) var(--basis) 0 0',\n        height: 'var(--prefix-icon-size)',\n        width: 'var(--prefix-icon-size)',\n      }}\n    />\n    prefixes.push(checkbox_component)\n  }\n\n\n\n  return <div className={text_style_class} style={{\n    display: 'flex',\n  }}>\n    <div>\n      {prefixes}\n    </div>\n    <HtmlInput\n      defaultValue={text}\n      onChange={setText}\n      onBlur={publishTextChange}\n\n      placeholder={getString('placeholder_text')}\n      style={{\n        ...colorStyles,\n        flexGrow: 1,\n        margin: '0',\n        padding: '0',\n        backgroundColor: 'transparent',\n      }}\n      linebreaks={true}\n      className={`hide_border`}\n\n      onInputRef={onInputRef}\n      onGoToPrevInput={onGoToPrevInput}\n      onGoToNextInput={onGoToNextInput}\n      onMergeToPrevInput={() => onMergeToPrevInput(block)}\n      onMergeFromNextInput={() => onMergeFromNextInput(block)}\n      onSplitText={onSplitText}\n    />\n  </div>\n}\n\nconst InlineEditorBlockText = withLocalization(InlineEditorBlockTextRaw)\n\nexport default InlineEditorBlockText\n","import React, { useState, useCallback } from 'react'\n\nimport { withLocalization } from '../../fluent/Localized.js'\nimport { getBlockColor } from '../../functions.js'\n\nimport FancyInput from './FancyInput.js'\nimport HtmlInput from './HtmlInput.js'\nimport UrlInput from './UrlInput.js'\n\nfunction InlineEditorBlockButtonRaw({\n  getString,\n  block = {},\n  onChange,\n\n  onInputRef,\n  onGoToPrevInput,\n  onGoToNextInput,\n  onSplitText,\n  onMergeToPrevInput,\n  onMergeFromNextInput,\n}) {\n  const properties = block.properties || {}\n  const [text, setText] = useState(properties.text || '')\n  const {\n    url: og_url = ''\n  } = properties\n  const [url, setUrl] = useState(og_url)\n\n  const publishChanges = useCallback(() => {\n    if (onChange) {\n      const newBlock = {\n        _id: block._id,\n        properties: {\n          text,\n        },\n      }\n\n      if (url === '') {\n        if(newBlock.properties.hasOwnProperty('url')) {\n          delete newBlock.properties.url\n        }\n      } else {\n        newBlock.properties.url = url\n      }\n\n      onChange(newBlock)\n    }\n  }, [onChange, block, text, url])\n  \n  const {\n    color,\n    colorRGB,\n    contrastingColor,\n  } = getBlockColor(block)\n\n  const colorStyles = {}\n  if (color) {\n    colorStyles['--on-background-rgb'] = colorRGB\n    colorStyles['--button-background'] = color\n    colorStyles['--button-color'] = contrastingColor\n  }\n\n  return <div style={{\n    margin: '0 0 var(--basis) 0',\n    cursor: 'auto',\n    ...colorStyles,\n  }}\n  className=\"clickable_card active\"\n  >\n    <HtmlInput\n      defaultValue={text}\n      onChange={setText}\n      onBlur={publishChanges}\n\n      placeholder={getString('placeholder_button')}\n      style={{\n        margin: '0',\n        ...colorStyles,\n      }}\n      linebreaks={true}\n      className=\"hide_border type_button default\"\n\n      onInputRef={onInputRef}\n      onGoToPrevInput={onGoToPrevInput}\n      onGoToNextInput={onGoToNextInput}\n      onMergeToPrevInput={() => onMergeToPrevInput(block)}\n      onMergeFromNextInput={() => onMergeFromNextInput(block)}\n      onSplitText={onSplitText}\n    />\n\n    <FancyInput>\n      {({ setError }) => (\n        <UrlInput\n          onError={setError}\n          onChange={setUrl}\n          onBlur={publishChanges}\n          defaultValue={url}\n          placeholder={getString('action_input_url_placeholder')}\n          style={{\n            margin: 'var(--basis) 0 0 0',\n            width: '100%',\n          }}\n        />\n      )}\n    </FancyInput>\n  </div>\n}\n\nconst InlineEditorBlockButton = withLocalization(InlineEditorBlockButtonRaw)\n\nexport default InlineEditorBlockButton\n","import React, { useRef, useCallback } from 'react'\n\nimport { withLocalization } from '../../fluent/Localized.js'\nimport { getBlockColor } from '../../functions.js'\n\nimport {\n  ArrowForward as ToIcon,\n} from '@mui/icons-material'\n\nimport FancyInput from './FancyInput.js'\nimport HtmlInput from './HtmlInput.js'\nimport UrlInput from './UrlInput.js'\nimport SlugInput from './SlugInput.js'\nimport BlockIcon from '../view/BlockIcon.js'\n\n\nfunction InlineEditorBlockRedirectRaw({\n  getString,\n  block = {},\n  onChange,\n\n  onInputRef,\n  onGoToPrevInput,\n  onGoToNextInput,\n  onSplitText,\n  onMergeToPrevInput,\n  onMergeFromNextInput,\n\n  style = {},\n}) {\n  const properties = block.properties || {}\n  const {\n    slug: og_slug = '',\n    url: og_url = ''\n  } = properties\n\n  const textRef = useRef(properties.text || '')\n  const text = textRef.current\n  const setText = newValue => textRef.current = newValue\n\n  const slugRef = useRef(og_slug || '')\n  const slug = slugRef.current\n  const setSlug = newValue => slugRef.current = newValue\n\n  const urlRef = useRef(og_url || '')\n  const url = urlRef.current\n  const setUrl = newValue => urlRef.current = newValue\n\n  const publishChanges = useCallback(() => {\n    if (onChange) {\n      const text = textRef.current\n      const slug = slugRef.current\n      const url = urlRef.current\n\n      const newBlock = {\n        _id: block._id,\n        properties: {\n          text,\n        },\n      }\n\n      if (slug === '') {\n        if (newBlock.properties.hasOwnProperty('slug')) {\n          delete newBlock.properties.slug\n        }\n      } else {\n        newBlock.properties.slug = slug\n      }\n\n      if (url === '') {\n        if (newBlock.properties.hasOwnProperty('url')) {\n          delete newBlock.properties.url\n        }\n      } else {\n        newBlock.properties.url = url\n      }\n\n      onChange(newBlock)\n    }\n  }, [ onChange, block ])\n  \n  const {\n    color = 'inherit',\n    colorRGB = '--on-background-rgb',\n  } = getBlockColor(block)\n\n  return <div style={{\n    ...style,\n    margin: '0 0 var(--basis) 0',\n    cursor: 'auto',\n    '--on-background-rgb': colorRGB,\n    paddingInlineStart: 'var(--basis_x4)',\n  }}\n  className=\"clickable_card active\"\n  >\n    <div style={{ width: '100%', display: 'flex', alignItems: 'center', color }}>\n      <BlockIcon block={block} />\n\n      <HtmlInput\n        defaultValue={text}\n        onChange={setText}\n        onBlur={publishChanges}\n\n        placeholder={getString('placeholder_headline_empty')}\n        style={{\n          flexGrow: '1',\n          width: '100%',\n          margin: '0',\n          fontWeight: 'bold',\n          backgroundColor: 'transparent',\n          color,\n        }}\n        linebreaks={true}\n        className=\"hide_border type_text\"\n\n        onInputRef={onInputRef}\n        onGoToPrevInput={onGoToPrevInput}\n        onGoToNextInput={onGoToNextInput}\n        onMergeToPrevInput={() => onMergeToPrevInput(block)}\n        onMergeFromNextInput={() => onMergeFromNextInput(block)}\n        onSplitText={onSplitText}\n      />\n    </div>\n\n    <div style={{ paddingInlineStart: 'var(--basis_x8)', width: '100%', display: 'flex', alignItems: 'center', }}>\n      volt.link/\n      <FancyInput style={{ width: '100%', marginInlineStart: 'var(--basis)' }}>\n        {({ setError }) => (\n          <SlugInput\n            onError={setError}\n            onChange={setSlug}\n            onBlur={publishChanges}\n            defaultValue={slug}\n            placeholder={getString('trigger_input_path_placeholder')}\n            style={{\n              margin: 'var(--basis) 0',\n              width: '100%',\n            }}\n          />\n        )}\n      </FancyInput>\n    </div>\n\n    <div style={{ paddingInlineStart: 'var(--basis_x8)', width: '100%', display: 'flex', alignItems: 'center', }}>\n      <ToIcon\n        style={{\n          flexShrink: 0,\n          margin: '0 var(--basis) 0 0',\n        }}\n      />\n\n      <FancyInput style={{ width: '100%' }}>\n        {({ setError }) => (\n          <UrlInput\n            onError={setError}\n            onChange={setUrl}\n            onBlur={publishChanges}\n            defaultValue={url}\n            placeholder={getString('action_input_url_placeholder')}\n            style={{\n              margin: 'var(--basis) 0',\n              width: '100%',\n            }}\n          />\n        )}\n      </FancyInput>\n    </div>\n  </div>\n}\n\nconst InlineEditorBlockRedirect = withLocalization(InlineEditorBlockRedirectRaw)\n\nexport default InlineEditorBlockRedirect\n","import { getBlockColor } from '../../functions.js'\n\nexport default function InlineEditorBlockDivider({ block }) {\n  const {\n    color,\n  } = getBlockColor(block)\n\n  const styles = {}\n  if (color) {\n    styles['--on-background'] = color\n  }\n\n  return <hr style={styles} />\n}\n","import React, { useState, useCallback, useRef } from 'react'\n\nimport { withLocalization } from '../../fluent/Localized.js'\n\nimport HtmlInput from './HtmlInput.js'\nimport CheckboxInput from './CheckboxInput.js'\n\nfunction InlineEditorBlockCheckboxRaw({\n  getString,\n  block = {},\n  onChange,\n\n  onInputRef,\n  onGoToPrevInput,\n  onGoToNextInput,\n  onSplitText,\n  onMergeToPrevInput,\n  onMergeFromNextInput,\n}) {\n  const properties = block.properties || {}\n  const [text, setText] = useState(properties.text || '')\n  const checked = useRef(Boolean(properties.checked))\n\n  const publishChanges = useCallback(() => {\n    if (onChange) {\n      onChange({\n        _id: block._id,\n        properties: {\n          text,\n          checked: checked.current,\n        },\n      })\n    }\n  }, [onChange, block, text])\n\n  const saveChecked = useCallback(newValue => {\n    checked.current = newValue\n    publishChanges()\n  }, [ publishChanges ])\n\n  return <div style={{ display: 'flex' }}>\n    <CheckboxInput\n      checked={checked.current}\n      onChange={saveChecked}\n    />\n\n    <HtmlInput\n      defaultValue={text}\n      onChange={setText}\n      onBlur={publishChanges}\n\n      placeholder={getString('placeholder_text')}\n      style={{\n        flexGrow: '1',\n        width: '100%',\n        margin: '0',\n        backgroundColor: 'transparent',\n      }}\n      linebreaks={true}\n      className=\"hide_border type_text\"\n\n      onInputRef={onInputRef}\n      onGoToPrevInput={onGoToPrevInput}\n      onGoToNextInput={onGoToNextInput}\n      onMergeToPrevInput={() => onMergeToPrevInput(block)}\n      onMergeFromNextInput={() => onMergeFromNextInput(block)}\n      onSplitText={onSplitText}\n    />\n  </div>\n}\n\nconst InlineEditorBlockCheckbox = withLocalization(InlineEditorBlockCheckboxRaw)\n\nexport default InlineEditorBlockCheckbox\n","import React from 'react'\n\nimport ViewerAuto from '../view/ViewerAuto.js'\n\nexport default function InlineEditorBlockPerson({\n  block = {},\n}) {\n  return <div style={{ margin: '0 0 var(--basis) 0' }}>\n    <ViewerAuto\n      dragable={true}\n      size=\"line\"\n      block={block}\n      style={{\n        flexGrow: '1',\n        width: '100%',\n      }}\n      pathSuffix=\"edit\"\n    />\n  </div>\n}\n","import React from 'react'\n\nimport ViewerAuto from '../view/ViewerAuto.js'\n\nexport default function InlineEditorBlockPage({\n  block = {},\n}) {\n  return <div style={{ margin: '0 0 var(--basis) 0' }}>\n    <ViewerAuto\n      key={block}\n      dragable={true}\n      size=\"line\"\n      block={block}\n      style={{\n        flexGrow: '1',\n        width: '100%',\n      }}\n      pathSuffix=\"edit\"\n    />\n  </div>\n}\n","import React, { useState, useCallback } from 'react'\n\nimport { withLocalization } from '../../fluent/Localized.js'\nimport { getBlockColor } from '../../functions.js'\n\nimport HtmlInput from './HtmlInput.js'\nimport ImagePicker from './ImagePicker.js'\n\nimport {\n  ImageSharp as ImageIcon,\n} from '@mui/icons-material'\n\nfunction InlineEditorBlockImageRaw({\n  getString,\n  block = {},\n  onChange,\n\n  onInputRef,\n  onGoToPrevInput,\n  onGoToNextInput,\n  onSplitText,\n  onMergeToPrevInput,\n  onMergeFromNextInput,\n}) {\n  const properties = block.properties || {}\n  const [text, setText] = useState(properties.text || '')\n\n  let og_coverphoto = ''\n  if (\n    properties.hasOwnProperty('coverphoto')\n    && properties.coverphoto.hasOwnProperty('type')\n  ) {\n    og_coverphoto = properties.coverphoto\n  }\n  const [coverphoto, setCoverphoto] = useState(og_coverphoto)\n\n  const publishChanges = useCallback(() => {\n    if (onChange) {\n      const newBlock = {\n        _id: block._id,\n        properties: {\n          text,\n        },\n      }\n\n      if (coverphoto === null) {\n        if (newBlock.properties.hasOwnProperty('coverphoto')) {\n          delete newBlock.properties.coverphoto\n        }\n      } else {\n        newBlock.properties.coverphoto = coverphoto\n      }\n\n      onChange(newBlock)\n    }\n  }, [onChange, block, text, coverphoto])\n\n  const saveCoverphoto = useCallback(newCoverphoto => {\n    setCoverphoto(newCoverphoto)\n    publishChanges()\n  }, [publishChanges])\n  \n  const {\n    color,\n    colorRGB,\n    contrastingColor,\n  } = getBlockColor(block)\n\n  const colorStyles = {}\n  if (color) {\n    colorStyles['--on-background-rgb'] = colorRGB\n    colorStyles['--button-background'] = color\n    colorStyles['--button-color'] = contrastingColor\n  }\n\n  let imageUrl = ''\n  if (coverphoto?.type === 'url') {\n    if (typeof coverphoto?.url === 'string' && coverphoto?.url.length > 0) {\n      imageUrl = `${window.domains.storage}download_url?f=${window.imageFormat || 'jpg'}&w=150&h=150&url=${encodeURIComponent(coverphoto.url)}`\n    }\n  } else if (coverphoto?.type === 'file') {\n    if (typeof coverphoto?.fileId === 'string' && coverphoto?.fileId.length > 0) {\n      imageUrl = `${window.domains.storage}download_file/?f=${window.imageFormat || 'jpg'}&w=150&h=150&id=${encodeURIComponent(coverphoto.fileId)}`\n    }\n  }\n\n  const alt = (typeof text === 'string' && text.length > 0) ? text : 'Image Preview'\n  const title = alt\n\n  return <div style={{\n    margin: '0 0 var(--basis) 0',\n    cursor: 'auto',\n    ...colorStyles,\n  }}\n  className=\"clickable_card active\"\n  >\n    <div style={{\n      marginBottom: 'var(--basis)',\n    }}>\n    {\n      imageUrl !== ''\n        ? <img\n          src={imageUrl}\n          alt={alt}\n          title={title}\n          style={{\n            maxWidth: '150px',\n            maxHeight: '100px',\n            boxShadow: 'inset 0 0 0 1px rgba(var(--on-background-rgb), var(--alpha-less))',\n          }}\n        />\n        : getString('inline_editor_image_block_explainer_title')\n    }\n    </div>\n\n    <ImagePicker\n      imageValue={coverphoto}\n      onChange={saveCoverphoto}\n      types={['url', 'file']}\n      trigger={(triggerProps) => (\n        <button {...triggerProps} className=\"hasIcon default\" style={{ margin: 0 }}>\n          <ImageIcon className=\"icon\" />\n          <span style={{ marginInlineStart: 'var(--basis_x2)', verticalAlign: 'middle' }}>Choose an Image</span>\n        </button>\n      )}\n    />\n\n    <HtmlInput\n      defaultValue={text}\n      onChange={setText}\n      onBlur={publishChanges}\n\n      placeholder={getString('placeholder_image_alt_text')}\n      style={{\n        margin: 'var(--basis) 0 0 0',\n        ...colorStyles,\n      }}\n      linebreaks={true}\n      className=\"type_p default\"\n    />\n  </div>\n}\n\nconst InlineEditorBlockImage = withLocalization(InlineEditorBlockImageRaw)\n\nexport default InlineEditorBlockImage\n","import React, { useState, useCallback, useEffect } from 'react'\n\nimport { withLocalization } from '../../fluent/Localized.js'\n\nimport BlockMenu from './BlockMenu.js'\nimport useSaveBlock from '../../hooks/useSaveBlock.js'\n\nimport InlineEditorBlockText from './InlineEditorBlockText.js'\nimport InlineEditorBlockButton from './InlineEditorBlockButton.js'\nimport InlineEditorBlockRedirect from './InlineEditorBlockRedirect.js'\nimport InlineEditorBlockDivider from './InlineEditorBlockDivider.js'\nimport InlineEditorBlockCheckbox from './InlineEditorBlockCheckbox.js'\nimport InlineEditorBlockPerson from './InlineEditorBlockPerson.js'\nimport InlineEditorBlockPage from './InlineEditorBlockPage.js'\nimport InlineEditorBlockImage from './InlineEditorBlockImage.js'\n// import InlineEditorBlockCode from './InlineEditorBlockCode.js'\n\nimport classes from './InlineEditorBlock.module.css'\n\n// function addIds(array){\n//   if (Array.isArray(array)) {\n//     return array.map(item => {\n//       let new_item = { ...item }\n//       if (!new_item.hasOwnProperty('_id')) {\n//         new_item._id = uuidv4()\n//       }\n//       return new_item\n//     })\n//   }\n//   return array\n// }\n\n// function stripIDs(array){\n//   return [...array].map(obj => {\n//     const obj_new = { ...obj }\n//     delete obj_new._id\n//     return obj_new\n//   })\n// }\n\nfunction InlineEditorBlockInbetweenComponent({ type = 'text', ...props }){\n  let component = null\n\n  switch (type) {\n    case 'button':\n      component = <InlineEditorBlockButton {...props} />\n      break;\n    case 'redirect':\n      component = <InlineEditorBlockRedirect {...props} />\n      break;\n    case 'divider':\n      component = <InlineEditorBlockDivider {...props} />\n      break;\n    case 'checkbox':\n      component = <InlineEditorBlockCheckbox {...props} />\n      break;\n    case 'person':\n      component = <InlineEditorBlockPerson {...props} />\n      break;\n    case 'page':\n      component = <InlineEditorBlockPage {...props} />\n      break;\n    case 'image':\n      component = <InlineEditorBlockImage {...props} />\n      break;\n    // case 'code':\n    //   component = <InlineEditorBlockCode {...props} />\n    //   break;\n    default:\n      component = <InlineEditorBlockText {...props} />\n  }\n\n  return component\n}\n\nfunction InlineEditorBlockRaw({\n  fluentByObject,\n  getString,\n  contentConfig = {},\n  className,\n  onChange,\n  reorderHandle,\n  onRemoveRow,\n  actionButton,\n  dataset = {},\n  addRowBefore,\n  addRowAfter,\n  permissions = [],\n\n  onInputRef,\n  onGoToPrevInput,\n  onGoToNextInput,\n  onSplitText,\n  onMergeToPrevInput,\n  onMergeFromNextInput,\n  onRemoveSelf,\n}) {\n  const saveBlock = useSaveBlock()\n\n  // const defaultLocale = getString('default_locale')\n\n  const [block, setBlock] = useState({\n    ...(contentConfig.block || { type: 'text' }),\n    _id: contentConfig.blockId || null,\n  })\n  const properties = block.properties || {}\n  const active = typeof properties.active === 'boolean' ? properties.active : true\n\n  useEffect(() => {\n    if (contentConfig.block) {\n      setBlock(contentConfig.block)\n    }\n  }, [contentConfig.block])\n\n  const handleBlockChange = useCallback(newBlock => {\n    saveBlock(newBlock)\n      .then(gottenBlock => {\n        setBlock(gottenBlock)\n        if (!block._id || block._id !== gottenBlock._id) {\n          onChange({\n            blockId: gottenBlock._id,\n            block: gottenBlock,\n          })\n        }\n      })\n  }, [block, onChange, saveBlock])\n\n  const saveType = useCallback(newValue => {\n    handleBlockChange({\n      _id: block._id,\n      type: newValue,\n    })\n  }, [block, handleBlockChange])\n\n  const saveProperty = useCallback((propertyName, newValue) => {\n    if (typeof propertyName === 'string') {\n      if (newValue === null || newValue === undefined) {\n        newValue = null\n      }\n\n      handleBlockChange({\n        _id: block._id,\n        properties: {\n          [propertyName]: newValue,\n        },\n      })\n    }\n  }, [block._id, handleBlockChange])\n\n  // const handleChange = useCallback(newBlock => {\n  //   setBlock(newBlock)\n  //\n  //   if (onChange) {\n  //     const target = wrapperDiv.current\n  //     target.value = newBlock\n  //     onChange({ target })\n  //   }\n  // }, [setBlock, onChange])\n\n  const handleSaveBlock = useCallback((newBlock, callback) => {\n    saveBlock(newBlock)\n      .then(gottenBlock => {\n        if (typeof callback === 'function') {\n          callback(gottenBlock)\n        }\n      })\n      .catch(console.error)\n  }, [ saveBlock ])\n\n  const onArchiveToggle = useCallback(newArchivedValue => {\n    if (typeof onRemoveSelf === 'function') {\n      onRemoveSelf()\n    }\n  }, [onRemoveSelf])\n\n  return <div\n    className={`${classes.block} ${className}`}\n    {...dataset}\n  >\n\n    <BlockMenu\n      {...{\n        block,\n        saveType,\n        saveProperty,\n        onRemoveRow,\n        addRowBefore,\n        addRowAfter,\n      }}\n\n      onArchivedToggle={onArchiveToggle}\n\n      trigger={props => (\n        <div\n          {...props}\n          className={classes.reorderHandle}\n        >\n          {reorderHandle}\n        </div>\n      )}\n    />\n\n    <div className={`${classes.block_input} ${(active ? classes.form_active : classes.form_deactivated)}`}>\n      <InlineEditorBlockInbetweenComponent\n        type={block.type}\n        block={block}\n        onChange={handleBlockChange}\n        onSaveBlock={handleSaveBlock}\n        saveProperty={saveProperty}\n\n        onInputRef={onInputRef}\n        onGoToPrevInput={onGoToPrevInput}\n        onGoToNextInput={onGoToNextInput}\n        onSplitText={onSplitText}\n        onMergeToPrevInput={onMergeToPrevInput}\n        onMergeFromNextInput={onMergeFromNextInput}\n\n        onAddRowAfter={addRowAfter}\n      />\n    </div>\n\n  </div>\n}\n\nconst InlineEditorBlock = withLocalization(InlineEditorBlockRaw)\n\nexport default InlineEditorBlock\n","import { useState, useRef, useEffect, useCallback } from 'react'\n\nimport { v4 as uuidv4 } from 'uuid'\n\nimport {\n  Add as AddIcon,\n} from '@mui/icons-material'\nimport {\n  Tooltip,\n} from '@mui/material'\n\nimport { Localized } from '../../fluent/Localized.js'\nimport InlineEditorBlock from './InlineEditorBlock.js'\nimport useLoadBlocks from '../../hooks/useLoadBlocks.js'\nimport useSaveBlock from '../../hooks/useSaveBlock.js'\nimport useArchiveBlock from '../../hooks/useArchiveBlock.js'\n// import { useTranslatedInputContext } from './TranslatedInput.js'\n\nimport AddMenu from './AddMenu.js'\n\nimport { DragDropContext, Droppable, Draggable } from 'react-beautiful-dnd'\nimport DragIndicatorIcon from '@mui/icons-material/DragIndicator'\n\nimport classes from './ContentEditor.module.css'\n\n// function stripTmpIds(array){\n//   return [...array].map(obj => {\n//     const obj_new = { ...obj }\n//     delete obj_new._id\n//     return obj_new\n//   })\n// }\n\nfunction addTmpIds(array) {\n  return [...array].map(obj => {\n    const obj_new = { ...obj }\n    obj_new.tmp_id = uuidv4()\n    return obj_new\n  })\n}\n\nfunction getFirstLineStartNode(element){\n  element.normalize()\n\n  const childNodes = element.childNodes\n  if (childNodes.length > 0) {\n    return childNodes[0]\n  }\n\n  return element\n}\n\nfunction getLastLineStartNode(element) {\n  element.normalize()\n\n  const childNodes = [...element.childNodes].reverse()\n  if (childNodes.length > 0) {\n    let lastLineNode = element\n    if (childNodes[0].nodeType === 3) {\n      for (const childNode of childNodes) {\n        if (childNode.nodeType === 3) {\n          lastLineNode = childNode\n        } else if (childNode.nodeType === 1) {\n          break\n        }\n      }\n    } else {\n      if (childNodes.length > 1) {\n        if (childNodes[1].nodeType === 3) {\n          const thisChildNodes = childNodes.slice(1)\n          for (const childNode of thisChildNodes) {\n            if (childNode.nodeType === 3) {\n              lastLineNode = childNode\n            } else if (childNode.nodeType === 1) {\n              break\n            }\n          }\n        }\n      }\n    }\n\n    return lastLineNode\n  }\n\n  return element\n}\n\nfunction moveCursorToOffsetInLine(contentEditableElement, lastLineStartNode, offset = 0) {\n  contentEditableElement.focus()\n\n  // If this function exists... (IE 9+)\n  if (window.getSelection) {\n    const lastLineStartNodeLength = (\n      lastLineStartNode.nodeType === 3\n        ? lastLineStartNode.length\n        : lastLineStartNode.innerText.length\n    )\n\n    if (offset === -1 || offset > lastLineStartNodeLength) {\n      offset = lastLineStartNodeLength\n    }\n\n    const range = document.createRange()\n    range.setStart(lastLineStartNode, 0)\n    range.setEnd(lastLineStartNode, offset)\n    range.collapse(false) // false = collapse to end\n    const sel = window.getSelection()\n    sel.removeAllRanges()\n    sel.addRange(range)\n  }\n}\n\nfunction reorder(list, startIndex, endIndex) {\n  const result = Array.from(list)\n  const [removed] = result.splice(startIndex, 1)\n  result.splice(endIndex, 0, removed)\n\n  return result\n}\n\nfunction ContentEditor({ parentId, defaultValue = [], onChange }) {\n  // const [contentConfigs, setContentConfigs] = useState([])\n  const contentConfigs_Ref = useRef([])\n  const contentConfigs = contentConfigs_Ref.current\n\n  // const [inputRefs, setInputRefs] = useState({})\n  const inputRefs_Ref = useRef({})\n  const inputRefs = inputRefs_Ref.current\n\n  const [updateCounter, setUpdateCounter] = useState(0)\n\n  const loadBlocks = useLoadBlocks()\n  const saveBlock = useSaveBlock()\n  const archiveBlock = useArchiveBlock()\n\n  const [autoFocus, setAutoFocus] = useState(null)\n  useEffect(()=>{\n    if (typeof autoFocus === 'object' && autoFocus !== null) {\n      if (\n        inputRefs.hasOwnProperty(autoFocus.tmp_id)\n      ) {\n        const inputRef = inputRefs[autoFocus.tmp_id]\n        if (\n          typeof inputRef === 'object'\n          && inputRef !== null\n        ) {\n          if (autoFocus.inFirstLine === true) {\n            const firstLineStartNode = getFirstLineStartNode(inputRef.current)\n            moveCursorToOffsetInLine(inputRef.current, firstLineStartNode, autoFocus.positionFromLineStart)\n          } else if (autoFocus.inLastLine === true) {\n            const lastLineStartNode = getLastLineStartNode(inputRef.current)\n            moveCursorToOffsetInLine(inputRef.current, lastLineStartNode, autoFocus.positionFromLineStart)\n          }\n          setAutoFocus(null)\n        }\n      }\n    }\n  }, [\n    autoFocus,\n    setAutoFocus,\n    inputRefs,\n  ])\n\n  useEffect(()=>{\n    async function loadMissingBlocks () {\n      let newContentConfigs = [...addTmpIds(defaultValue)]\n\n      const ids2load = newContentConfigs\n        .filter(contentConfig => !contentConfig.hasOwnProperty('block'))\n        .map(contentConfig => contentConfig.blockId)\n\n      let loadedBlocks = []\n      if (ids2load.length > 0) {\n        loadedBlocks = await loadBlocks({ ids: ids2load })\n      }\n      \n      newContentConfigs = newContentConfigs\n        .map(contentConfig => {\n          if (!contentConfig.hasOwnProperty('block')) {\n            contentConfig.block = loadedBlocks.find(block => block._id === contentConfig.blockId)\n          }\n          return contentConfig\n        })\n\n      contentConfigs_Ref.current = newContentConfigs\n      setUpdateCounter(old => old + 1)\n    }\n\n    if (contentConfigs.length === 0) {\n      if (defaultValue.length > 0) {\n        loadMissingBlocks()\n      }\n    }\n  }, [contentConfigs, defaultValue, loadBlocks, contentConfigs_Ref, setUpdateCounter])\n\n  const saveInputRef = useCallback((keys, inputRef) => {\n    const newInputRefs = {...inputRefs_Ref.current}\n\n    if (\n      !newInputRefs.hasOwnProperty(keys.tmp_id)\n      || newInputRefs[keys.tmp_id] !== inputRef\n    ) {\n      newInputRefs[keys.tmp_id] = inputRef\n      inputRefs_Ref.current = newInputRefs\n    }\n  }, [ inputRefs_Ref ])\n\n  const goToPrevInput = useCallback((keys, { caret }) => {\n    const index = keys.index\n\n    let prevInputRef = null\n    for (let thisIndex = contentConfigs.length-1; thisIndex >= 0; thisIndex--) {\n      const tmp_id = contentConfigs[thisIndex].tmp_id\n      if (thisIndex < index && inputRefs[tmp_id] && inputRefs[tmp_id].current) {\n        prevInputRef = inputRefs[tmp_id]\n        break\n      }\n    }\n\n    if (prevInputRef) {\n      const lastLineStartNode = getLastLineStartNode(prevInputRef.current)\n      moveCursorToOffsetInLine(prevInputRef.current, lastLineStartNode, caret.positionFromLineStart)\n    }\n  }, [ contentConfigs, inputRefs ])\n\n  const goToNextInput = useCallback((keys, { caret }) => {\n    const index = keys.index\n\n    let nextInputRef = null\n    for (let thisIndex = 0; thisIndex < contentConfigs.length; thisIndex++) {\n      const tmp_id = contentConfigs[thisIndex].tmp_id\n      if (thisIndex > index && inputRefs[tmp_id] && inputRefs[tmp_id].current) {\n        nextInputRef = inputRefs[tmp_id]\n        break\n      }\n    }\n\n    if (nextInputRef) {\n      const firstLineStartNode = getFirstLineStartNode(nextInputRef.current)\n      moveCursorToOffsetInLine(nextInputRef.current, firstLineStartNode, caret.positionFromLineStart)\n    }\n  }, [ contentConfigs, inputRefs ])\n\n  const focusLastLine = useCallback(() => {\n    let lastInputRef = null\n    for (let thisIndex = contentConfigs.length-1; thisIndex >= 0; thisIndex--) {\n      const tmp_id = contentConfigs[thisIndex].tmp_id\n      if (inputRefs[tmp_id] && inputRefs[tmp_id].current) {\n        lastInputRef = inputRefs[tmp_id]\n        break\n      }\n    }\n\n    if (lastInputRef) {\n      const lastLineStartNode = getLastLineStartNode(lastInputRef.current)\n      moveCursorToOffsetInLine(lastInputRef.current, lastLineStartNode, -1)\n    }\n  }, [ contentConfigs, inputRefs ])\n\n  const handleRowChange = useCallback((keys, newContentConfig) => {\n    const newContentConfigs = [...contentConfigs]\n    for (const index in newContentConfigs) {\n      const oldContentConfig = newContentConfigs[index]\n      if (oldContentConfig.tmp_id === keys.tmp_id) {\n        newContentConfigs[index] = {\n          ...oldContentConfig,\n          ...newContentConfig,\n        }\n        break\n      }\n    }\n\n    contentConfigs_Ref.current = newContentConfigs\n    onChange(newContentConfigs)\n\n    return new Promise(resolve => {\n      resolve(newContentConfigs)\n    })\n  }, [contentConfigs, contentConfigs_Ref, onChange])\n\n  const addRowByIndex = useCallback((index, offset = 0, newContentConfig) => {\n    if (typeof newContentConfig === 'object') {\n      newContentConfig = {\n        tmp_id: uuidv4(),\n        ...newContentConfig,\n      }\n    } else {\n      newContentConfig = newContentConfig || { tmp_id: uuidv4() }\n    }\n\n    const newBlock = newContentConfig.block || null\n\n    if (\n      newBlock !== null\n      && typeof index === 'number'\n      && !isNaN(index)\n    ) {\n      saveBlock(newBlock)\n        .then(async gottenBlock => {\n          const loadedBlocks = await loadBlocks({ ids: [gottenBlock._id] })\n\n          if (loadedBlocks.length > 0) {\n            const loadedBlock = loadedBlocks[0]\n\n            newContentConfig.block = loadedBlock\n            newContentConfig.blockId = loadedBlock._id\n\n            let new_rows = [...contentConfigs]\n            new_rows.splice(index + offset, 0, newContentConfig)\n            contentConfigs_Ref.current = new_rows\n            onChange(new_rows)\n          }\n        })\n        .catch(console.error)\n    }\n  }, [contentConfigs, contentConfigs_Ref, saveBlock, loadBlocks, onChange])\n\n  const createBlockByType = useCallback(({ type, close }) => {\n    const newBlock = { type }\n\n    if (typeof parentId === 'string' && parentId.length > 0) { // a valid parentId should be 24 char long\n      newBlock.parent = parentId\n    }\n\n    addRowByIndex(0, 0, { block: newBlock })\n\n    if (typeof close === 'function') {\n      close()\n    }\n  }, [addRowByIndex, parentId])\n\n  const onMergeToPrevInput = useCallback(keys => {\n    const {\n      index,\n    } = keys\n\n    const clonedContentConfigs = [...contentConfigs]\n    if (index > 0) {\n      const prev_index = index - 1\n      const prev_contentConfig = clonedContentConfigs[prev_index]\n      const prev_tmp_id = prev_contentConfig.tmp_id\n\n      const this_block = clonedContentConfigs[index].block\n      const prev_block = clonedContentConfigs[prev_index].block\n\n      let prev_text = ''\n      if (prev_block && prev_block.hasOwnProperty('properties')) {\n        prev_text = prev_block.properties.text || ''\n      }\n\n      let this_text = ''\n      if (this_block && this_block.hasOwnProperty('properties')) {\n        this_text = this_block.properties.text || ''\n      }\n\n      const prev_block_properties2update = {\n        _id: prev_block._id,\n        properties: {\n          text: prev_text + this_text,\n        },\n      }\n\n      const thisRef = inputRefs_Ref.current[prev_tmp_id]\n      const textLength = thisRef.current.textContent.length\n\n      saveBlock(prev_block_properties2update)\n        .then(savedPrevBlock => {\n          const new_tmp_id = uuidv4()\n          handleRowChange({\n            index: prev_index,\n            tmp_id: prev_tmp_id,\n          }, {\n            ...prev_contentConfig,\n            tmp_id: new_tmp_id,\n            blockId: savedPrevBlock._id,\n            block: savedPrevBlock,\n          })\n            .then(newContentConfigs => {\n              const this_block = newContentConfigs[index].block\n              newContentConfigs.splice(index, 1) // delete the block\n\n              archiveBlock({ _id: this_block._id, archive: true })\n                .then(() => {\n                  contentConfigs_Ref.current = newContentConfigs\n                  setAutoFocus({\n                    tmp_id: new_tmp_id,\n                    positionFromLineStart: textLength,\n                    inFirstLine: false,\n                    inLastLine: true,\n                  })\n                  onChange(newContentConfigs)\n                })\n            })\n        })\n        .catch(console.error)\n    } else {\n      // This is the first row. Nothing to merge into.\n    }\n  }, [ contentConfigs, inputRefs_Ref, saveBlock, handleRowChange, archiveBlock, contentConfigs_Ref, setAutoFocus, onChange ])\n\n  const onMergeFromNextInput = useCallback(keys => {\n    const {\n      index,\n      tmp_id,\n    } = keys\n\n    const clonedContentConfigs = [...contentConfigs]\n    if (index < clonedContentConfigs.length - 1) {\n\n      const next_index = index + 1\n\n      const this_old_contentConfig = clonedContentConfigs[index]\n      const this_block = clonedContentConfigs[index].block\n      const next_block = clonedContentConfigs[next_index].block\n\n      let this_text = ''\n      if (this_block && this_block.hasOwnProperty('properties')) {\n        this_text = this_block.properties.text || ''\n      }\n\n      let next_text = ''\n      if (next_block && next_block.hasOwnProperty('properties')) {\n        next_text = next_block.properties.text || ''\n      }\n\n      const this_block_properties2update = {\n        _id: this_block._id,\n        properties: {\n          text: this_text + next_text,\n        },\n      }\n\n      const thisRef = inputRefs_Ref.current[tmp_id]\n      const textLength = thisRef.current.textContent.length\n\n      saveBlock(this_block_properties2update)\n        .then(savedBlock => {\n          const new_tmp_id = uuidv4()\n          handleRowChange(keys, {\n            ...this_old_contentConfig,\n            tmp_id: new_tmp_id,\n            blockId: savedBlock._id,\n            block: savedBlock,\n          })\n            .then(newContentConfigs => {\n              const next_block = newContentConfigs[next_index].block\n              newContentConfigs.splice(next_index, 1) // delete the block\n\n              archiveBlock({ _id: next_block._id, archive: true })\n                .then(() => {\n                  contentConfigs_Ref.current = newContentConfigs\n                  setAutoFocus({\n                    tmp_id: new_tmp_id,\n                    positionFromLineStart: textLength,\n                    inFirstLine: false,\n                    inLastLine: true,\n                  })\n                  onChange(newContentConfigs)\n                })\n            })\n        })\n        .catch(console.error)\n\n\n\n\n      // // const firstBlock = rows[index]\n      // // const secondBlock = rows[index + 1]\n\n      // // get current text length (we know the caret is at the end of the text)\n      // const thisRef = inputRefs[tmp_id]\n      // const textLength = thisRef.current.textContent.length\n\n      // // refocus the input at the last caret position\n      // const lastLineStartNode = getLastLineStartNode(thisRef.current)\n      // moveCursorToOffsetInLine(thisRef.current, lastLineStartNode, textLength) // we can't use a text length of -1, as the text length will be changed after the merge\n    } else {\n      // This is the last row. Nothing to merge into.\n    }\n  }, [ contentConfigs, inputRefs_Ref, saveBlock, handleRowChange, archiveBlock, contentConfigs_Ref, setAutoFocus, onChange ])\n\n  const splitText = useCallback((keys, { texts }) => {\n    const {\n      index,\n      tmp_id,\n    } = keys\n\n    const newContentConfigs = [...contentConfigs]\n\n    const block = (newContentConfigs.find(block => block.tmp_id === tmp_id)).block || {}\n\n    const firstBlock = {\n      ...block,\n      properties: {\n        ...block.properties,\n        text: texts[0],\n      },\n    }\n\n    const secondBlock = {\n      ...block,\n      properties: {\n        ...block.properties,\n        text: texts[1],\n      },\n    }\n    delete secondBlock._id\n\n    saveBlock(firstBlock)\n      .then(savedFirstBlock => {\n        saveBlock(secondBlock)\n          .then(savedSecondBlock => {\n            newContentConfigs[index] = {\n              ...newContentConfigs[index],\n              tmp_id: uuidv4(),\n              blockId: savedFirstBlock._id,\n              block: savedFirstBlock,\n            }\n\n            const nextContentConfig = {\n              tmp_id: uuidv4(),\n              blockId: savedSecondBlock._id,\n              block: savedSecondBlock,\n            }\n            newContentConfigs.splice(index + 1, 0, nextContentConfig)\n\n            contentConfigs_Ref.current = newContentConfigs\n            onChange(newContentConfigs)\n            setAutoFocus({\n              tmp_id: nextContentConfig.tmp_id,\n              positionFromLineStart: 0,\n              inFirstLine: true,\n              inLastLine: false,\n            })\n          })\n          .catch(console.error)\n        })\n      .catch(console.error)\n  }, [\n    contentConfigs,\n    saveBlock,\n    contentConfigs_Ref,\n    onChange,\n    setAutoFocus,\n  ])\n\n  const handleRemoveSelf = useCallback(keys => {\n    const {\n      index,\n    } = keys\n\n    const newContentConfigs = [...contentConfigs]\n    newContentConfigs.splice(index, 1) // delete the block\n\n    contentConfigs_Ref.current = newContentConfigs\n\n    onChange(newContentConfigs)\n  }, [ contentConfigs, onChange ])\n\n  function onDragEnd(result) {\n    if (!result.destination) {\n      return\n    }\n\n    if (result.destination.index === result.source.index) {\n      return\n    }\n\n    const newContentConfigs = reorder(\n      contentConfigs,\n      result.source.index,\n      result.destination.index\n    )\n\n    contentConfigs_Ref.current = newContentConfigs\n    onChange(newContentConfigs)\n  }\n\n  const filteredContentConfigs = contentConfigs\n    .filter(Boolean)\n    .filter(contentConfig => contentConfig.tmp_id)\n\n  return <>\n  <div\n    key={updateCounter}\n    style={{\n      position: 'relative',\n      width: '1000px',\n      maxWidth: '100%',\n      margin: 'var(--basis_x8) auto 0 auto',\n    }}\n  >\n    <div>\n      <AddMenu\n        types={[\n          'button',\n          'text',\n          'image',\n          // 'code',\n          'divider',\n          'page',\n          'redirect',\n        ]}\n        createBlock={createBlockByType}\n        trigger={triggerProps => \n          <button\n            {...triggerProps}\n            className=\"text hasIcon\"\n            style={{\n              margin: '0 0 var(--basis_x2) 0',\n            }}\n          >\n            <span style={{pointerEvents: 'none'}}>\n              <AddIcon className=\"icon\" />\n              <span style={{marginInlineStart: 'var(--basis_x2)', verticalAlign: 'middle'}}>\n                <Localized id=\"add_content_before\" />\n              </span>\n            </span>\n          </button>\n        }\n      />\n    </div>\n\n    <DragDropContext onDragEnd={onDragEnd}>\n      <Droppable\n        droppableId=\"list\"\n        isDropDisabled={false}\n      >\n        {provided => (\n          <div\n            ref={provided.innerRef}\n            {...provided.droppableProps}\n            className=\"inputBorder\"\n            style={{\n              '--input-box-shadow': 'inset var(--basis_x8) 0 0 0 var(--background), inset var(--basis_x8) 0 0 var(--basis_x0_2) var(--on-background-contrast), inset 0 0 0 var(--basis_x0_2) var(--on-background-contrast)',\n              boxShadow: 'var(--input-box-shadow)',\n              paddingTop: filteredContentConfigs.length > 0 ? 'var(--basis)' : '',\n              paddingRight: 'var(--basis)',\n            }}\n          >\n            {\n              filteredContentConfigs\n              .map(\n                (contentConfig, index) => {\n                  const tmp_id = contentConfig.tmp_id\n                  const keys = {\n                    index,\n                    tmp_id,\n                  }\n\n                  return <Draggable\n                    key={tmp_id}\n                    draggableId={tmp_id}\n                    index={index}\n                    isDragDisabled={false}\n                    disableInteractiveElementBlocking={true}\n                    shouldRespectForcePress={true}\n                  >\n                    {provided => (\n                      <div\n                        ref={provided.innerRef}\n                        {...provided.draggableProps}\n\n                        key={tmp_id}\n                        className={classes.row}\n                      >\n                      <div className={classes.form}>\n                        <InlineEditorBlock\n                          key={tmp_id}\n                          className={classes.item}\n                          dataset={{\n                            'data-index': index,\n                            'data-id': tmp_id,\n                          }}\n                          contentConfig={contentConfig}\n\n                          reorderHandle={\n                            <Tooltip title={<div style={{ textAlign: 'center' }}>\n                              <strong>Drag</strong> to move.<br />\n                              <strong>Click</strong> to open menu.\n                            </div>}>\n                              <button\n                                className={`text ${classes.inlineRowButton} ${classes.dragHandleButton}`}\n                                {...provided.dragHandleProps}\n                              >\n                                <DragIndicatorIcon />\n                              </button>\n                            </Tooltip>\n                          }\n\n                          onRemoveSelf={ () => handleRemoveSelf(keys) }\n                          addRowBefore={ (newValue) => addRowByIndex(index, 0, newValue) }\n                          addRowAfter={ (newValue) => addRowByIndex(index, 1, newValue) }\n\n                          onInputRef={(inputRef) => saveInputRef(keys, inputRef)}\n                          onGoToPrevInput={(attr) => goToPrevInput(keys, attr)}\n                          onGoToNextInput={(attr) => goToNextInput(keys, attr)}\n                          onSplitText={(attr) => splitText(keys, attr)}\n                          onChange={(attr) => handleRowChange(keys, attr)}\n                          onMergeToPrevInput={(attr) => onMergeToPrevInput(keys, attr)}\n                          onMergeFromNextInput={(attr) => onMergeFromNextInput(keys, attr)}\n                          // {...repeater_props}\n                        />\n                      </div>\n                    </div>\n                    )}\n                  </Draggable>\n                }\n              )\n            }\n            {provided.placeholder}\n          </div>\n        )}\n      </Droppable>\n    </DragDropContext>\n  </div>\n\n  <div\n    style={{\n      position: 'relative',\n      height: '50vh',\n      cursor: (filteredContentConfigs.length === 0 ? 'default' : 'text'),\n    }}\n    onClick={filteredContentConfigs.length === 0 ? null : focusLastLine}\n  ></div>\n  </>\n}\n\nexport default ContentEditor\n","import { useState, useCallback } from 'react'\n\nimport useSaveBlock from '../../hooks/useSaveBlock.js'\n\nimport { Helmet } from 'react-helmet'\n\n// import Select from 'react-select'\n\nimport {\n  // TranslateSharp as TranslateIcon,\n  IosShareSharp as ShareIcon,\n  SaveSharp as SaveIcon,\n  MoreVertSharp as BlockMenuIcon,\n} from '@mui/icons-material'\n\nimport MdiIcon from '@mdi/react'\nimport {\n  mdiTranslate,\n  mdiLockAlert, // mdiLock\n  mdiAccountLockOpen, // mdiAccountGroup\n  mdiEarth, // mdiLockOpen mdiEarth mdiLockOpenVariant\n} from '@mdi/js'\n\nimport classes from './PageEditor.module.css'\n\nimport { Localized, useLocalization } from '../../fluent/Localized.js'\n// import { useTranslatedInputContext, LocalesMenu } from '../edit/TranslatedInput.js'\n\nimport Header from '../Header.js'\nimport BlockMenu from '../edit/BlockMenu.js'\nimport SharingEditor from '../edit/SharingEditor.js'\nimport TranslationEditor from '../edit/TranslationEditor.js'\nimport PermissionsEditor from '../edit/PermissionsEditor.js'\nimport PropertiesEditor from '../edit/PropertiesEditor.js'\nimport ContentEditor from '../edit/ContentEditor.js'\n\n// const custom_react_select_styles = {\n//   menu: (provided, state) => ({\n//     ...provided,\n//     background: 'var(--purple)',\n//   }),\n// }\n// const custom_react_select_theme = theme => ({\n//   ...theme,\n//   borderRadius: 0,\n//   colors: {\n//     ...theme.colors,\n//     primary: 'var(--green)',\n//     primary25: 'var(--purple-dark)',\n//   },\n// })\n\nfunction flattenObject(obj, parentKey = null, res = {}) {\n  // source: https://jeffdevslife.com/p/flatten-object-with-javascript/\n  for (let key in obj) {\n    const propName = parentKey ? parentKey + '.' + key : key\n    if (typeof (obj[key]) === 'object' && !Array.isArray(obj[key])) {\n      flattenObject(obj[key], propName, res)\n    } else {\n      res[propName] = obj[key]\n    }\n  }\n  return res\n}\n\nfunction unflattenObject(obj) {\n  // source: https://jeffdevslife.com/p/unflatten-object-with-javascript/\n  let res = {}\n  for (let key in obj) {\n    const keys = key.split('.')\n    keys.reduce((acc, value, index) => {\n      return acc[value] || (acc[value] = keys.length - 1 === index ? obj[key] : {})\n    }, res)\n  }\n  return res\n}\n\nfunction PageEditor({\n  block,\n  onSaveBlock,\n}) {\n  const { getString } = useLocalization()\n\n  const saveBlock = useSaveBlock()\n\n  // const { currentLocale, setLocales } = useTranslatedInputContext()\n\n  const [ isSharingEditorOpen, setIsSharingEditorOpen ] = useState(false)\n  const openSharingEditor = useCallback(() => setIsSharingEditorOpen(true), [ setIsSharingEditorOpen ])\n  const closeSharingEditor = useCallback(() => setIsSharingEditorOpen(false), [ setIsSharingEditorOpen ])\n\n  const [ isTranslationEditorOpen, setIsTranslationEditorOpen ] = useState(false)\n  const openTranslationEditor = useCallback(() => setIsTranslationEditorOpen(true), [ setIsTranslationEditorOpen ])\n  const closeTranslationEditor = useCallback(() => setIsTranslationEditorOpen(false), [ setIsTranslationEditorOpen ])\n\n  const [ isPermissionsEditorOpen, setIsPermissionsEditorOpen ] = useState(false)\n  const openPermissionsEditor = useCallback(() => setIsPermissionsEditorOpen(true), [ setIsPermissionsEditorOpen ])\n  const closePermissionsEditor = useCallback(() => setIsPermissionsEditorOpen(false), [ setIsPermissionsEditorOpen ])\n\n  // const [block, setBlock] = useState({\n  //   type: defaultType || 'page',\n  //   properties: defaultProperties || {},\n  //   content: defaultContent || [],\n  //   ...defaultBlockRest,\n  // })\n  const type = block.type\n  const properties = block.properties\n  const content = block.content\n  const permissions = block.permissions\n\n  const saveType = useCallback(newType => {\n    if (newType !== block.type) {\n      const newBlock = {\n        ...block,\n        type: newType,\n      }\n\n      saveBlock(newBlock)\n        .then(gottenBlock => {\n          onSaveBlock(gottenBlock)\n        })\n    }\n  }, [block, saveBlock, onSaveBlock])\n\n  const saveProperties = useCallback(newProperties => {\n    if (newProperties !== block.properties) {\n      const oldPropertiesFlattend = flattenObject(block.properties)\n      const newPropertiesFlattend = flattenObject(newProperties)\n\n      let divergingProperties = {}\n\n      for (const key in newPropertiesFlattend) {\n        if (newPropertiesFlattend.hasOwnProperty(key)) {\n          if (oldPropertiesFlattend[key] !== newPropertiesFlattend[key]) {\n            divergingProperties[key] = newPropertiesFlattend[key]\n          }\n        }\n      }\n\n      for (const key in oldPropertiesFlattend) {\n        if (\n          oldPropertiesFlattend.hasOwnProperty(key)\n          && !newPropertiesFlattend.hasOwnProperty(key)\n          && !divergingProperties.hasOwnProperty(key)\n        ) {\n          divergingProperties[key] = null\n        }\n      }\n\n      divergingProperties = unflattenObject(divergingProperties)\n\n      if (Object.keys(divergingProperties).length > 0) {\n        saveBlock({\n          _id: block._id,\n          properties: divergingProperties,\n        })\n          .then(gottenBlock => {\n            onSaveBlock(gottenBlock)\n          })\n      }\n    }\n  }, [block, saveBlock, onSaveBlock])\n\n  const saveProperty = useCallback((propertyName, newValue) => {\n    if (typeof propertyName === 'string') {\n      saveBlock({\n        _id: block._id,\n        properties: {\n          [propertyName]: newValue\n        }\n      })\n        .then(gottenBlock => {\n          onSaveBlock(gottenBlock)\n        })\n    }\n  }, [block, saveBlock, onSaveBlock])\n\n  const saveContent = useCallback(newContent => {\n    if (newContent !== block.content) {\n      const newBlock = {\n        _id: block._id,\n        content: newContent,\n      }\n\n      saveBlock(newBlock)\n        .then(gottenBlock => {\n          onSaveBlock(gottenBlock)\n        })\n    }\n  }, [block, saveBlock, onSaveBlock])\n\n  const savePermissions = useCallback(newPermissions => {\n    if (newPermissions !== block.permissions) {\n      const newBlock = {\n        _id: block._id,\n        permissions: newPermissions,\n      }\n\n      saveBlock(newBlock)\n        .then(gottenBlock => {\n          onSaveBlock(gottenBlock)\n        })\n    }\n  }, [block, saveBlock, onSaveBlock])\n\n  const manuallySaveEverything = useCallback(() => {\n    saveBlock(block)\n      .then(gottenBlock => {\n        if (gottenBlock._id !== block._id) {\n          onSaveBlock(gottenBlock)\n        }\n      })\n  }, [saveBlock, block, onSaveBlock])\n\n  // const isFirstRun = useRef(true)\n  // useEffect(() => {\n  //   if (isFirstRun.current) {\n  //     isFirstRun.current = false\n  //     return;\n  //   }\n  //\n  //   if (\n  //     Object.keys(block).length > 0\n  //     && JSON.stringify(initialBlock) !== JSON.stringify(block)\n  //   ) {\n  //   }\n  // }, [isFirstRun, initialBlock, block])\n\n\n\n  // START permissions icon\n  let PermissionsIcon = mdiLockAlert\n  if (\n    !!block\n    && !!block.computed\n    && !!block.computed.inherited_block_permissions\n    && Array.isArray(block.computed.inherited_block_permissions)\n  ) {\n    const inherited_block_permissions_obj = block.computed.inherited_block_permissions\n      .reduce((acc, curr) => {\n        acc[curr.email] = curr.role\n        return acc\n      }, {})\n\n    if (\n      inherited_block_permissions_obj['@public'] === 'viewer'\n      || inherited_block_permissions_obj['@public'] === 'editor'\n      || inherited_block_permissions_obj['@public'] === 'owner'\n    ) {\n      PermissionsIcon = mdiEarth\n    } else if (\n      inherited_block_permissions_obj['@volteuropa.org'] === 'viewer'\n      || inherited_block_permissions_obj['@volteuropa.org'] === 'editor'\n      || inherited_block_permissions_obj['@volteuropa.org'] === 'owner'\n    ) {\n      PermissionsIcon = mdiAccountLockOpen\n    }\n  }\n  // END permissions icon\n\n\n\n  const rightHeaderActions = <div className=\"buttonRow\" style={{ whiteSpace: 'nowrap' }}>\n    {/* <button className=\"text\"><Localized id=\"path_editor_share\"/></button> */}\n\n\n    {/*\n    <LocalesMenu\n      trigger={triggerProps => (\n        <button {...triggerProps} className=\"text hasIcon\">\n          <TranslateIcon className=\"icon\" />\n          <span className=\"hideOnSmallScreen\" style={{verticalAlign: 'middle'}}>\n            <Localized id=\"path_editor_translate\" />\n            {getString('locale_'+currentLocale)}\n          </span>\n        </button>\n      )}\n    />\n    */}\n\n    {\n      isSharingEditorOpen\n      ? <SharingEditor\n          defaultBlock={block}\n          open={isSharingEditorOpen}\n          onClose={closeSharingEditor}\n          onChange={saveProperties}\n        />\n      : null\n    }\n    <button className=\"text hasIcon\" onClick={openSharingEditor}>\n      <ShareIcon className=\"icon\" />\n      <span className=\"hideOnSmallScreen\" style={{verticalAlign: 'middle'}}><Localized id=\"path_editor_share\" /></span>\n    </button>\n\n    {\n      type !== 'divider'\n      ? <>\n        {\n          isTranslationEditorOpen\n          ? <TranslationEditor\n              defaultBlock={block}\n              open={isTranslationEditorOpen}\n              onClose={closeTranslationEditor}\n              onSaveProperty={saveProperty}\n            />\n          : null\n        }\n        <button className=\"text hasIcon\" onClick={openTranslationEditor}>\n          <MdiIcon\n            path={mdiTranslate}\n            className=\"icon\"\n          />\n          <span className=\"hideOnSmallScreen\" style={{verticalAlign: 'middle'}}><Localized id=\"path_editor_translate\" /></span>\n        </button>\n      </>\n      : null\n    }\n\n    {\n      isPermissionsEditorOpen\n      ? <PermissionsEditor\n          defaultPermissions={permissions}\n          open={isPermissionsEditorOpen}\n          onClose={closePermissionsEditor}\n          onChange={savePermissions}\n        />\n      : null\n    }\n    <button className=\"red hasIcon\" onClick={openPermissionsEditor}>\n      <MdiIcon\n        path={PermissionsIcon}\n        className=\"icon\"\n      />\n      <span className=\"hideOnSmallScreen\" style={{verticalAlign: 'middle'}}><Localized id=\"path_editor_permissions\" /></span>\n    </button>\n\n    <button className=\"text hasIcon\" onClick={manuallySaveEverything}>\n      <SaveIcon className=\"icon\" />\n      <span className=\"hideOnSmallScreen\" style={{verticalAlign: 'middle'}}><Localized id=\"path_editor_publish\" /></span>\n    </button>\n\n    <BlockMenu\n      {...{\n        block,\n        saveType,\n        saveProperty,\n      }}\n\n      typeOptions={[\n        'page',\n        'redirect',\n      ]}\n\n      trigger={props => (\n        <button\n          {...props}\n          className=\"default hasIcon\"\n        >\n          <BlockMenuIcon className=\"icon\" />\n        </button>\n      )}\n    />\n  </div>\n\n  const title = block?.properties?.text || getString('placeholder_headline_empty')\n  const helmet_title = ` ${title}`\n\n  return <div key={block._id} className={`hasHeader ${classes.editor} ${typeof type === 'string' && type !== '' ? classes['type_'+type] : ''}`}>\n    <Helmet>\n      <title>{helmet_title}</title>\n      <meta name=\"title\" content={helmet_title} />\n      <meta name=\"og:title\" content={helmet_title} />\n      <meta name=\"twitter:title\" content={helmet_title} />\n\n      <meta name=\"description\" content=\"\" />\n      <meta property=\"og:description\" content=\"\" />\n      <meta name=\"twitter:description\" content=\"\" />\n\n      <meta property=\"og:image\" content=\"\" />\n      <meta name=\"twitter:image\" content=\"\" />\n\n      <meta property=\"twitter:card\" content=\"summary\" />\n    </Helmet>\n    \n    <Header\n      block={block}\n      // title={<a href={`https://volt.link/${slug}`} target=\"_blank\" rel=\"noopener noreferrer\"><span className=\"hideOnSmallScreen\">volt.link</span>/{slug}</a>}\n      title={title}\n      rightActions={rightHeaderActions}\n    />\n\n    <PropertiesEditor\n      type={type}\n      defaultProperties={properties}\n      onChange={saveProperties}\n    />\n\n    <ContentEditor\n      parentId={block._id || null}\n      onChange={saveContent}\n      defaultValue={content}\n    />\n  </div>\n}\n\nexport default PageEditor\n","import React, { lazy, Suspense, useRef, useState, useEffect, useCallback } from 'react'\n\nimport {\n  useParams,\n} from 'react-router-dom'\n\nimport { Localized } from '../fluent/Localized.js'\nimport useLoadPage from '../hooks/useLoadPage.js'\nimport useLoadBlocks from '../hooks/useLoadBlocks.js'\n\nimport Header from '../components/Header.js'\nimport ViewerAuto from '../components/view/ViewerAuto.js'\n\nimport PageEditor from '../components/apps/PageEditor.js'\n\nimport classes from './Viewer.module.css'\n\nconst ErrorPage = lazy(() => import('../components/ErrorPage.js'))\n\nfunction Editor() {\n  const loadingTheBlock = useRef(false)\n\n  const loadPage = useLoadPage()\n  const loadBlocks = useLoadBlocks()\n\n  let { id: slugOrId = '' } = useParams()\n\n  let slugOrId_to_use = slugOrId\n\n  if (slugOrId.includes('=')) {\n    const [, id] = slugOrId.split('=')\n    slugOrId_to_use = id\n  }\n\n  const [block, setBlock] = useState({\n    type: 'page',\n    properties: {},\n    content: [],\n  })\n\n  const [error, setError] = useState(null)\n\n  const setAndTrackError = useCallback(error => {\n    setError(error)\n\n    if (\n      !!window.umami\n      && typeof error === 'object'\n      && error !== null\n      && error.hasOwnProperty('code')\n      && typeof error.code === 'string'\n    ) {\n      window.umami.trackEvent('E: ' + error.code)\n    }\n  }, [setError])\n\n  useEffect(() => {\n    const properties = block.properties || {}\n\n    if (\n      loadingTheBlock.current === false\n      && typeof slugOrId_to_use === 'string'\n      && slugOrId_to_use !== ''\n      && slugOrId_to_use !== block._id\n      && slugOrId_to_use !== properties.slug\n      && (\n        error === null\n        || error.for_slugOrId !== slugOrId_to_use\n      )\n    ) {\n      loadingTheBlock.current = true\n      loadPage(slugOrId_to_use)\n        .then(async loadedBlock => {\n          if (typeof loadedBlock !== 'object' || loadedBlock === null) {\n            setAndTrackError({\n              code: '404',\n              for_slugOrId: slugOrId_to_use,\n            })\n            loadingTheBlock.current = false\n          } else {\n            let newLoadedBlock = loadedBlock\n\n            if (\n              Array.isArray(loadedBlock.content)\n              && loadedBlock.content.length > 0\n            ) {\n              let newContentConfigs = [...loadedBlock.content]\n\n              const ids2load = loadedBlock.content\n                .filter(contentConfig => !contentConfig.hasOwnProperty('block'))\n                .map(contentConfig => contentConfig.blockId)\n\n              let loadedContentBlocks = []\n              if (ids2load.length > 0) {\n                loadedContentBlocks = await loadBlocks({ ids: ids2load })\n              }\n\n              newContentConfigs = newContentConfigs\n                .map(contentConfig => {\n                  if (!contentConfig.hasOwnProperty('block')) {\n                    contentConfig.block = loadedContentBlocks.find(block => block._id === contentConfig.blockId)\n                  }\n                  return contentConfig\n                })\n\n              newLoadedBlock = {\n                ...newLoadedBlock,\n                content: newContentConfigs,\n              }\n            }\n\n            setAndTrackError(null)\n            setBlock(newLoadedBlock)\n            loadingTheBlock.current = false\n          }\n        })\n        .catch(error => {\n          console.error(error)\n          setAndTrackError({\n            ...error,\n            for_slugOrId: slugOrId_to_use,\n          })\n          loadingTheBlock.current = false\n        })\n    }\n  }, [\n    error,\n    slugOrId_to_use,\n    block,\n    block._id,\n    loadPage,\n    setBlock,\n    loadBlocks,\n    setAndTrackError,\n  ])\n\n  if (error !== null && error.for_slugOrId === slugOrId_to_use) {\n    return <div className={classes.viewer}>\n      <Header\n        block={null}\n        title=\"Error\"\n        rightActions={null}\n      />\n      <div className={`basis_x1 ${classes.app} ${classes.spine_aligned}`} dir=\"auto\">\n        <main className={`${classes.contentWrapper}`}>\n          {\n            error.code === '300'\n              ? <>\n                <h1>\n                  <Localized id=\"error_300_title\" />\n                </h1>\n                <br />\n                <p>\n                  <Localized id=\"error_300_description\" />\n                </p>\n                <br />\n                {\n                  error.blocks.map(block => <ViewerAuto\n                    key={block._id}\n                    block={block}\n                    forceId={true}\n                    pathSuffix=\"edit\"\n                  />)\n                }\n              </>\n              : null\n          }\n          {\n            error.code === '403'\n              ? <Suspense>\n                <ErrorPage errorName=\"no_access\" />\n              </Suspense>\n              : null\n          }\n          {\n            error.code === '404'\n              ? <Suspense>\n                <ErrorPage errorName=\"not_found\" />\n              </Suspense>\n              : null\n          }\n        </main>\n      </div>\n    </div>\n  } else {\n    return <PageEditor\n      block={block}\n      onSaveBlock={setBlock}\n    />\n  }\n}\n\nexport default Editor\n"],"sourceRoot":""}